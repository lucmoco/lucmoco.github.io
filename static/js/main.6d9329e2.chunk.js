(this.webpackJsonpboussole=this.webpackJsonpboussole||[]).push([[0],{168:function(e,t,n){e.exports=n(330)},173:function(e,t,n){},174:function(e,t,n){},216:function(e,t){},218:function(e,t){},252:function(e,t){},253:function(e,t){},330:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(164),i=n.n(r),s=(n(173),n(174),n(28)),c=n(60),l=n(59),u=n(6),h=n.n(u),d=n(33),g=n(165),f=n(87),m=["https://www.googleapis.com/auth/userinfo.profile","https://www.googleapis.com/auth/drive"];window.boussoleAuthManager||(window.boussoleAuthManager=new function e(){var t=this;Object(g.a)(this,e),this.oAuth2Client=new f.OAuth2Client({clientId:"186913784324-6bjkvt7jsn309m5shsc7n33c7u516hq2.apps.googleusercontent.com",redirectUri:"".concat(window.location.origin,"/auth")}),this.state=void 0,this.listeners=[],this.setState=function(e){t.state=e,t.listeners.forEach((function(t){return t(e)}))},this.subscribe=function(e){t.listeners.push(e)},this.unsubscribe=function(e){var n=t.listeners.indexOf(e);n>-1&&t.listeners.splice(n,1)},this.getState=function(){return t.state},this.getOAuth2Client=function(){return t.oAuth2Client},this.oAuth2Client.transporter.configure();var n=new URLSearchParams(window.location.search),a=n.get("code");if(null!=a){n.get("state");console.debug("Auth: CodeReceived"),this.state={status:"CodeReceived"},Object(d.a)(h.a.mark((function e(){var n,o;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.debug("getting token..."),e.next=3,t.oAuth2Client.getToken({code:a,codeVerifier:sessionStorage.getItem("auth-codeVerifier")});case 3:n=e.sent,sessionStorage.removeItem("auth-codeVerifier"),console.log("Credentials: ",n),t.oAuth2Client.setCredentials(n.tokens),localStorage.setItem("refresh_token",n.tokens.refresh_token||""),t.setState({status:"RedirectingToOriginalPage"}),o=sessionStorage.getItem("original-page"),window.history.replaceState(null,"",o),sessionStorage.removeItem("original-page"),t.setState({status:"Authenticated"});case 13:case"end":return e.stop()}}),e)})))()}else{var o=localStorage.getItem("refresh_token");o?(this.state={status:"Authenticated"},this.oAuth2Client.setCredentials({refresh_token:o})):(console.debug("Auth: RedirectingToGoogle"),this.state={status:"RedirectingToGoogle"},Object(d.a)(h.a.mark((function e(){var n,a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.oAuth2Client.generateCodeVerifierAsync();case 2:n=e.sent,sessionStorage.setItem("auth-codeVerifier",n.codeVerifier),sessionStorage.setItem("original-page",window.location.href),a=t.oAuth2Client.generateAuthUrl({scope:m,code_challenge:n.codeChallenge,code_challenge_method:f.CodeChallengeMethod.S256,login_hint:"lucmoco@gmail.com",state:window.location.pathname}),window.location.href=a;case 7:case"end":return e.stop()}}),e)})))())}});var p=window.boussoleAuthManager;function w(){var e=Object(a.useState)(p.getState()),t=Object(l.a)(e,2),n=t[0],r=t[1];return o.a.useEffect((function(){var e;e=r,p.subscribe(e)}),[]),n}function v(){return b.apply(this,arguments)}function b(){return(b=Object(d.a)(h.a.mark((function e(){var t,n,a,o,r,i,s,c;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=p.getOAuth2Client(),n=new URLSearchParams({q:"'root' in parents and mimeType = 'application/vnd.google-apps.folder' and name = 'notes-perso-boussole'",fields:"files/id"}),e.next=4,t.request({url:"https://www.googleapis.com/drive/v3/files?".concat(n)});case 4:return a=e.sent,o=a.data.files[0].id,r=new URLSearchParams({q:"'".concat(o,"' in parents and name = 'notes.json'"),fields:"files/id"}),e.next=9,t.request({url:"https://www.googleapis.com/drive/v3/files?".concat(r)});case 9:return i=e.sent,s=i.data.files[0].id,e.next=13,t.request({url:"https://www.googleapis.com/drive/v3/files/".concat(s,"?alt=media")});case 13:return c=e.sent,e.abrupt("return",c.data);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(){var e=o.a.useState(""),t=Object(l.a)(e,2),n=t[0],a=t[1];return o.a.useEffect((function(){Object(d.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=a,e.next=3,v();case 3:e.t1=e.sent,(0,e.t0)(e.t1);case 5:case"end":return e.stop()}}),e)})))()})),o.a.createElement("div",null,"Page content: ",n)}function E(){var e=Object(s.f)();return o.a.createElement(o.a.Fragment,null,"Invalid path: \xab ",e.pathname," \xbb")}var C=function(){var e=w();return"Error"===e.status?o.a.createElement("div",null,'Authentication failed: "',e.errorMessage,'"'):"RedirectingToGoogle"===e.status?o.a.createElement("div",null,"Auth required. RedirectingToGoogle..."):"CodeReceived"===e.status?o.a.createElement("div",null,"CodeReceived..."):"RedirectingToOriginalPage"===e.status?o.a.createElement("div",null,"RedirectingToOriginalPage..."):o.a.createElement(c.a,null,o.a.createElement("div",{className:"App"},o.a.createElement("header",{className:"App-header"},o.a.createElement(c.b,{to:"/"},"Home"),o.a.createElement(c.b,{to:"/page"},"Page"),o.a.createElement("div",null,"Authentication Status: ",e&&e.status),o.a.createElement(A,null),o.a.createElement(s.c,null,o.a.createElement(s.a,{path:"/auth",exact:!0},"Authentication"),o.a.createElement(s.a,{path:"/",exact:!0},"Home"),o.a.createElement(s.a,{path:"/page",exact:!0},"Some page"),o.a.createElement(s.a,{path:"*"},o.a.createElement(E,null))))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(C,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},84:function(e,t){}},[[168,1,2]]]);
//# sourceMappingURL=main.6d9329e2.chunk.js.map