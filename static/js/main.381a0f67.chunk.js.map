{"version":3,"sources":["Components/Tasks/Tasks.module.scss","Components/Tags/TagComponent.module.scss","Components/App/App.module.scss","Components/TextEditor/TextEditor.module.scss","Components/Utility/Dialog/Dialog.module.scss","Components/IconDesigner/IconDesigner.module.scss","Components/Utility/Button/Button.module.scss","Components/Utility/Field/Field.module.scss","Components/LoadStatus/LoadStatus.module.scss","Components/Utility/Overlay/Overlay.module.scss","Components/Utility/Spacing.module.scss","Assets/boussole.svg","Components/ErrorBoundary/ErrorBoundary.tsx","Helpers/guidHelper.ts","Services/BoussoleDataService/BoussoleDataService.ts","Services/BoussoleDataStore/BoussoleDataStore.ts","Services/Auth/AuthManager.ts","Services/Auth/AuthManagerProvider.tsx","Services/BoussoleDataStore/BoussoleDataStoreProvider.tsx","Helpers/ParticleState/ParticleState.ts","Services/BoussoleDataState/BoussoleDataStateProvider.tsx","Services/BoussoleDataService/BoussoleDataServiceProvider.tsx","Helpers/tasksHelper.ts","Helpers/cssHelper.ts","Helpers/textHerlper.ts","Helpers/Colors.ts","Components/Tasks/TaskState/TaskStateIndicator.tsx","Components/Utility/Overlay/Overlay.tsx","Components/Utility/Button/Button.tsx","Components/Utility/Dialog/Dialog.tsx","Components/Tasks/TaskState/TaskStateChoice.tsx","Components/Tasks/TaskState/TaskStateEditionDialog.tsx","Components/Utility/Field/Field.tsx","DataModel/Tags.ts","Components/Tags/TagControl.tsx","Components/Tags/TagComponent.tsx","Components/Tags/TagEditionDialog.tsx","Components/Tasks/TaskForm.tsx","Components/Tasks/TaskEditionDialog.tsx","Components/Tasks/TaskComponent.tsx","Services/BoussoleData/BoussoleDataProvider.tsx","Assets/SaveImage.tsx","Components/App/PageLayout.tsx","Services/AutoSaver/AutoSaver.ts","Assets/FilterImage.tsx","Components/Tasks/TaskFilter.tsx","Components/Tasks/TaskList.tsx","Components/IconDesigner/IconPreview.tsx","Components/IconDesigner/IconDesigner.tsx","Components/TextEditor/TextEditorState.ts","Components/TextEditor/TextEditor.tsx","Components/TextEditor/AnalysisEditor.tsx","Components/App/AppComponent.tsx","Components/LoadStatus/LoadStatus.tsx","serviceWorker.ts","index.tsx","Components/App/App.tsx"],"names":["module","exports","ErrorBoundary","props","state","isError","error","errorInfo","this","setState","componentStack","children","React","getUniqueDigits","length","result","i","charAt","Math","floor","random","BoussoleDataService","store","createTask","task","updateState","tasks","id","now","Date","created","modified","updateTask","updates","Error","BoussoleDataStore","authManager","acquireToken","accessToken","fetch","headers","Authorization","response","json","storeModel","getAppState","data","getStoreModel","method","body","JSON","stringify","appState","taskId","push","undefined","tagId","title","description","dateClosed","forEach","storeTask","getTask","scopes","AuthManager","account","application","PublicClientApplication","auth","clientId","authority","handleRedirectPromise","accounts","getAllAccounts","loginRedirect","authenticate","acquireTokenSilent","authResult","AuthManagerContext","createContext","AuthManagerProvider","getNotAuthenticatedComponents","getAuthenticatedComponents","useMemo","useState","authenticated","setAuthenticated","useEffect","a","Provider","value","BoussoleDataStoreContext","BoussoleDataStoreProvider","useContext","useAuthManager","boussoleDataStore","useBoussoleDataStore","ParticleState","callbacks","getState","notify","updateFunc","newState","subscribe","callback","indexOf","filter","c","BoussoleDataStateContext","BoussoleDataStateProvider","getNotReadyComponents","getReadyComponents","boussoleDataState","setBoussoleDataState","loadData","useBoussoleDataState","BoussoleDataServiceContext","BoussoleDataServiceProvider","boussoleDataService","useBoussoleDataService","getClasses","args","name","join","getStateLabel","getColor","color","match","red","parseInt","substr","green","blue","getHexColor","component","round","toString","padStart","getCssColor","TaskColors","next","active","finished","abandoned","getStyle","showCurrentBorder","showNotCurrent","backgroundColor","borderColor","amount","TaskStateIndicator","showText","onClick","className","styles","taskStateIndicator","small","thickBorder","notCurrent","clickable","style","event","stopPropagation","Overlay","overlay","Button","isLight","isWide","button","light","wide","Dialog","buttons","dialog","content","map","onclick","text","TaskStateChoice","onChange","renderState","useCallback","buttonState","spacingStyles","spaceOutVerticalComponents","taskStateClosed","TaskStateEditionDialog","onClose","Field","label","field","AllTags","TagControl","noTag","onRemove","tag","ev","remove","TagComponent","find","t","TagEditionDialog","allTagIdsWithNull","allTagIds","TaskForm","tagEditFormOpen","setTagEditFormOpen","type","target","TaskEditionDialog","editedTask","setEditedTask","TaskComponent","taskEditDialogOpen","setTaskEditDialogOpen","stateEditDialogOpen","setStateEditDialogOpen","BoussoleDataContext","BoussoleDataProvider","boussoleData","setBoussoleData","SaveImage","xmlns","shapeRendering","textRendering","imageRendering","fillRule","clipRule","viewBox","d","PageLayout","headerControls","saveStatus","useRef","setSaveStatus","onModelChange","model","current","modelBeingSaved","modelToSave","saveData","useAutoSaver","to","saveButton","saving","height","width","FilterImage","fill","strokeWidth","strokeLinecap","strokeLinejoin","strokeMiterlimit","TaskFilter","visible","textRef","focus","tasksFilter","tasksFilterInner","ref","taskFilterText","getStateOrder","compare","task1","task2","localeCompare","toComparable","toLowerCase","normalize","replace","TaskList","useBoussoleData","filterVisible","setFilterVisible","filterValue","setFilterValue","newTaskFormOpen","setNewTaskFormOpen","stroke","taskList","Object","keys","sort","includes","sortAndFilterTasks","key","tasksButtons","IconPreview","svg","size","iconPreview","dangerouslySetInnerHTML","__html","IconDesigner","svgValue","setSvgValue","iconDesigner","TestTextEditorState","blocks","parts","href","strong","em","selection","countCharacters","block","reduce","total","part","replaceBlock","blockIndex","newBlock","console","warn","index","appendPart","previousPart","splice","subBlock","start","end","partStart","partIndex","partEnd","substring","mergeBlocks","slice","clearSelection","partialBlocks","charIndex","textTyped","partCharIndex","updatedParts","newPart","replacePart","position","deleteContentBackward","updatedBlock","cursorPos","newBlocks","previousBlock","deleteContentForward","insertParagraph","firstBlock","secondBlock","newPosition","node","nodeType","Node","TEXT_NODE","textContent","hasChildNodes","childNodes","computePosition","rootElement","offset","nodes","parentElement","firstLevelElement","nodeName","li","sibling","previousSibling","computeSelection","anchorNode","focusNode","contains","focusOffset","anchorOffset","anchor","renderPart","element","renderParts","elements","subParts","getSelectionNodeAndCharIndex","pos","nodeIndex","itemIndex","item","phrasingPart","getPhrasingPartAtIndex","parent","currentIndex","subPhrasingPart","TextEditor","sectionRef","beforeInputHandler","inputEvent","log","inputType","s","preventDefault","selectionChangeEventHandler","document","getSelection","useLayoutEffect","div","addEventListener","removeEventListener","window","rangeCount","removeRange","getRangeAt","editorCompatibleSelection","removeAllRanges","startNodeAndCharIndex","endNodeAndCharIndex","range","createRange","setStart","setEnd","addRange","ensureStateSelection","wrapper","contentEditable","textEditor","suppressContentEditableWarning","items","currentBlock","render","startContainer","startOffset","endContainer","endOffset","getBrowserSelection","AnalysisEditor","events","setEvents","cancelable","isComposing","desc","inputLogger","compositionEventLogger","observer","MutationObserver","mutationsList","mutation","attributeName","observe","attributes","childList","subtree","disconnect","outerHTML","NoMatch","location","useLocation","pathname","AppComponent","app","path","exact","LoadStatus","done","message","rects","x","y","rx","ry","loadStatus","src","logo","alt","loadBar","Boolean","hostname","ReactDOM","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.381a0f67.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"taskList\":\"Tasks_taskList__1j01R\",\"tasksFilter\":\"Tasks_tasksFilter__SByHK\",\"visible\":\"Tasks_visible__2gUcH\",\"tasksFilterInner\":\"Tasks_tasksFilterInner__37v1d\",\"taskFilterText\":\"Tasks_taskFilterText__1lomt\",\"tasks\":\"Tasks_tasks__4y0vu\",\"tasksButtons\":\"Tasks_tasksButtons__XJ-pN\",\"task\":\"Tasks_task__3bw5D\",\"title\":\"Tasks_title__1CtZZ\",\"taskForm\":\"Tasks_taskForm__oi8da\",\"button\":\"Tasks_button__25aul\",\"taskStateIndicator\":\"Tasks_taskStateIndicator__3zudG\",\"notCurrent\":\"Tasks_notCurrent__21dv8\",\"clickable\":\"Tasks_clickable__fAQfc\",\"thickBorder\":\"Tasks_thickBorder__3vSP1\",\"small\":\"Tasks_small__eHZhy\",\"taskStateClosed\":\"Tasks_taskStateClosed__2ySBA\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"tag\":\"TagComponent_tag__O9Do5\",\"noTag\":\"TagComponent_noTag__2j8yO\",\"clickable\":\"TagComponent_clickable__lE7XX\",\"active\":\"TagComponent_active__2nCyq\",\"remove\":\"TagComponent_remove__2SJVD\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"app\":\"App_app__32N6G\",\"saveButton\":\"App_saveButton__1Y4GW\",\"saving\":\"App_saving__19u3L\",\"blinker\":\"App_blinker__3O4-b\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"TextEditor_wrapper__2GZg2\",\"textEditor\":\"TextEditor_textEditor__Ivlrn\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"dialog\":\"Dialog_dialog__2jZTN\",\"title\":\"Dialog_title__1r951\",\"content\":\"Dialog_content__3EOpS\",\"buttons\":\"Dialog_buttons__1OnQ6\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"iconDesigner\":\"IconDesigner_iconDesigner__FdLiT\",\"iconPreview\":\"IconDesigner_iconPreview__2680x\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"button\":\"Button_button___qM3V\",\"wide\":\"Button_wide__3ejWw\",\"light\":\"Button_light__2KPpW\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"field\":\"Field_field__1UM57\",\"label\":\"Field_label__2F_cw\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"loadStatus\":\"LoadStatus_loadStatus__2d1fD\",\"loadBar\":\"LoadStatus_loadBar__eTTVa\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"overlay\":\"Overlay_overlay__3WkJQ\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"spaceOutVerticalComponents\":\"Spacing_spaceOutVerticalComponents__x2Ed8\"};","module.exports = __webpack_public_path__ + \"static/media/boussole.b5a6f5f8.svg\";","import * as React from 'react';\n\ninterface IErrorBoundaryState {\n  isError: boolean;\n  error: React.ErrorInfo | null;\n}\n\nexport class ErrorBoundary extends React.Component<{}, IErrorBoundaryState> {\n  constructor(props: {}) {\n    super(props);\n    this.state = { isError: false, error: null };\n  }\n\n  componentDidCatch(error: Error, errorInfo: React.ErrorInfo): void {\n    this.setState({ isError: true, error: errorInfo });\n  }\n\n  render(): any {\n    if (this.state.isError) {\n      return <div>{this.state.error!.componentStack}</div>;\n    }\n\n    return this.props.children;\n  }\n}\n","const Digits = '0123456789abcdef';\n\nfunction getUniqueDigits(length: number) {\n  var result = '';\n  for (var i = 0; i < length; i++) {\n    result += Digits.charAt(Math.floor(Math.random() * Digits.length));\n  }\n  return result;\n}\n\nexport function newGuid() {\n  return `${getUniqueDigits(8)}-${getUniqueDigits(4)}-${getUniqueDigits(4)}-${getUniqueDigits(4)}-${getUniqueDigits(\n    12\n  )}`;\n}\n","import { IBoussoleDataService } from './IBoussoleDataService';\r\nimport { IBoussoleDataState } from '../BoussoleDataState/IBoussoleDataState';\r\nimport { Task } from '../../DataModel/Task';\r\nimport { newGuid } from '../../Helpers/guidHelper';\r\n\r\nexport class BoussoleDataService implements IBoussoleDataService {\r\n  private store: IBoussoleDataState;\r\n\r\n  constructor(store: IBoussoleDataState) {\r\n    this.store = store;\r\n  }\r\n\r\n  public createTask = (task: Task) => {\r\n    this.store.updateState((tasks) => {\r\n      const id = newGuid();\r\n      const now = new Date();\r\n      tasks[id] = {\r\n        ...task,\r\n        id,\r\n        created: now,\r\n        modified: now,\r\n      };\r\n      return { ...tasks };\r\n    });\r\n  };\r\n\r\n  public updateTask = (id: string, updates: Partial<Task>) => {\r\n    this.store.updateState((tasks) => {\r\n      var task = tasks[id];\r\n      if (!task) throw new Error(`No task found with id {id}`);\r\n      tasks[id] = {\r\n        ...task,\r\n        ...updates,\r\n      };\r\n      return { ...tasks };\r\n    });\r\n  };\r\n}\r\n","import { IBoussoleDataStore } from './IBoussoleDataStore';\nimport { IAuthManager } from '../Auth/IAuthManager';\nimport { BoussoleData } from '../../DataModel/BoussoleData';\nimport { Task } from '../../DataModel/Task';\nimport { StoreTask, BoussoleDataStoreModel } from './BoussoleDataStoreModel';\n\nexport class BoussoleDataStore implements IBoussoleDataStore {\n  readonly authManager: IAuthManager;\n\n  public constructor(authManager: IAuthManager) {\n    this.authManager = authManager;\n  }\n\n  async loadData() {\n    var accessToken = await this.authManager.acquireToken();\n\n    var response = await fetch(\n      'https://graph.microsoft.com/v1.0/me/drive/root:/boussole-data-files/notes.json:/content',\n      { headers: { Authorization: 'Bearer ' + accessToken } }\n    );\n\n    var storeModel = await response.json();\n    return getAppState(storeModel);\n  }\n\n  async saveData(data: BoussoleData) {\n    var storeModel = getStoreModel(data);\n    var accessToken = await this.authManager.acquireToken();\n\n    await fetch('https://graph.microsoft.com/v1.0/me/drive/root:/boussole-data-files/notes.json:/content', {\n      method: 'PUT',\n      headers: {\n        'Content-Type': 'text/plain',\n        Authorization: 'Bearer ' + accessToken,\n      },\n      body: JSON.stringify(storeModel, null, '  '),\n    });\n  }\n}\n\n// *** Conversion from Application Model to Data Store Model and vice versa ***\n\nfunction getStoreTask(task: Task): StoreTask {\n  return {\n    state: task.state === 'created' ? undefined : task.state,\n    tagId: task.tagId || undefined,\n    id: task.id,\n    title: task.title,\n    description: task.description || undefined,\n    created: task.created,\n    modified: task.modified,\n    dateClosed: task.dateClosed,\n  };\n}\n\nfunction getStoreModel(appState: BoussoleData): BoussoleDataStoreModel {\n  const tasks: StoreTask[] = [];\n  for (const taskId in appState) {\n    tasks.push(getStoreTask(appState[taskId]));\n  }\n\n  return { tasks };\n}\n\nfunction getTask(storeTask: StoreTask): Task {\n  return {\n    state: storeTask.state || 'created',\n    tagId: storeTask.tagId || null,\n    id: storeTask.id,\n    title: storeTask.title,\n    description: storeTask.description || '',\n    created: storeTask.created,\n    modified: storeTask.modified,\n    dateClosed: storeTask.dateClosed,\n  };\n}\n\nfunction getAppState(storeModel: BoussoleDataStoreModel): BoussoleData {\n  const tasks: BoussoleData = {};\n\n  storeModel.tasks.forEach((storeTask) => (tasks[storeTask.id] = getTask(storeTask)));\n\n  return tasks;\n}\n","import { IAuthManager } from './IAuthManager';\r\nimport { PublicClientApplication, AccountInfo } from '@azure/msal-browser';\r\n\r\nconst scopes = ['https://graph.microsoft.com/Files.ReadWrite'];\r\n\r\nexport class AuthManager implements IAuthManager {\r\n  account: AccountInfo | undefined;\r\n\r\n  readonly application = new PublicClientApplication({\r\n    auth: {\r\n      clientId: 'c1fef6c7-2dd3-425b-aa1e-e9c94ca00c63',\r\n      authority: 'https://login.microsoftonline.com/consumers/',\r\n    },\r\n  });\r\n\r\n  async authenticate() {\r\n    await this.application.handleRedirectPromise();\r\n    var accounts = this.application.getAllAccounts();\r\n\r\n    if (accounts.length === 0) {\r\n      // a login is needed. The page execution will stop here.\r\n      await this.application.loginRedirect();\r\n    }\r\n\r\n    this.account = accounts[0];\r\n  }\r\n\r\n  async acquireToken() {\r\n    await this.authenticate();\r\n\r\n    var authResult = await this.application.acquireTokenSilent({\r\n      scopes,\r\n      account: this.account!,\r\n    });\r\n    return authResult.accessToken;\r\n  }\r\n}\r\n\r\nexport const getAuthManager = (): IAuthManager => {\r\n  return new AuthManager();\r\n};\r\n","import React from 'react';\r\nimport { IAuthManager } from './IAuthManager';\r\nimport { AuthManager } from './AuthManager';\r\n\r\nconst AuthManagerContext = React.createContext<IAuthManager>(undefined as any);\r\n\r\nexport interface IAuthManagerProviderProps {\r\n  getNotAuthenticatedComponents: () => React.ReactElement | null;\r\n  getAuthenticatedComponents: () => React.ReactElement | null;\r\n}\r\n\r\nexport const AuthManagerProvider: React.FC<IAuthManagerProviderProps> = ({\r\n  getNotAuthenticatedComponents,\r\n  getAuthenticatedComponents,\r\n}) => {\r\n  const authManager = React.useMemo(() => new AuthManager(), []);\r\n  const [authenticated, setAuthenticated] = React.useState(false);\r\n\r\n  React.useEffect(() => {\r\n    (async () => {\r\n      await authManager.authenticate();\r\n      setAuthenticated(true);\r\n    })();\r\n  }, [authManager]);\r\n\r\n  return (\r\n    <AuthManagerContext.Provider value={authManager}>\r\n      {authenticated ? getAuthenticatedComponents() : getNotAuthenticatedComponents()}\r\n    </AuthManagerContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useAuthManager = () => {\r\n  const authManager = React.useContext(AuthManagerContext);\r\n  if (!authManager) {\r\n    throw new Error('Please define an AuthManagerProvider upper in the component tree.');\r\n  }\r\n  return authManager;\r\n};\r\n","import React from 'react';\r\nimport { IBoussoleDataStore } from './IBoussoleDataStore';\r\nimport { BoussoleDataStore } from './BoussoleDataStore';\r\nimport { useAuthManager } from '../Auth/AuthManagerProvider';\r\n\r\nconst BoussoleDataStoreContext = React.createContext<IBoussoleDataStore>(undefined as any);\r\n\r\nexport const BoussoleDataStoreProvider: React.FC = ({ children }) => {\r\n  const authManager = useAuthManager();\r\n  const boussoleDataStore = React.useMemo(() => new BoussoleDataStore(authManager), [authManager]);\r\n  return <BoussoleDataStoreContext.Provider value={boussoleDataStore}>{children}</BoussoleDataStoreContext.Provider>;\r\n};\r\n\r\nexport const useBoussoleDataStore = () => {\r\n  const boussoleDataStore = React.useContext(BoussoleDataStoreContext);\r\n  if (!boussoleDataStore) {\r\n    throw new Error('Please define a BoussoleDataStoreProvider upper in the component tree.');\r\n  }\r\n  return boussoleDataStore;\r\n};\r\n","import { IParticleState, ParticleStateListener } from './IParticleState';\n\nexport const toto = 'tutu';\n\nexport class ParticleState<TState> implements IParticleState<TState> {\n  private state: TState;\n  private callbacks: ParticleStateListener<TState>[];\n\n  constructor(state: TState) {\n    this.state = state;\n    this.callbacks = [];\n  }\n\n  public getState = () => this.state;\n\n  public setState = (state: TState) => {\n    this.state = state;\n    this.notify();\n  };\n\n  public updateState = (updateFunc: (state: TState) => TState) => {\n    var newState = updateFunc(this.state);\n    if (newState !== this.state) {\n      this.state = newState;\n      this.notify();\n    }\n  };\n\n  public subscribe = (callback: ParticleStateListener<TState>) => {\n    if (this.callbacks.indexOf(callback) >= 0) {\n      throw new Error('The callback is already registered.');\n    }\n\n    this.callbacks.push(callback);\n\n    return () => {\n      this.callbacks = this.callbacks.filter((c) => c !== callback);\n    };\n  };\n\n  private notify = () => {\n    var state = this.state;\n    for (var callback of this.callbacks) {\n      if (this.state !== state) {\n        // a callback has updated the state again. The next callbacks are not called, all callbacks will be called with the new value.\n        return;\n      }\n\n      if (this.callbacks.indexOf(callback) < 0) {\n        // the callback has been removed in a callback.\n        continue;\n      }\n\n      callback(state);\n    }\n  };\n}\n","import React from 'react';\r\nimport { useBoussoleDataStore } from '../BoussoleDataStore/BoussoleDataStoreProvider';\r\nimport { ParticleState } from '../../Helpers/ParticleState/ParticleState';\r\nimport { BoussoleData } from '../../DataModel/BoussoleData';\r\nimport { IBoussoleDataState } from './IBoussoleDataState';\r\n\r\nconst BoussoleDataStateContext = React.createContext<IBoussoleDataState>(undefined as any);\r\n\r\nexport interface IBoussoleDataStateProviderProps {\r\n  getNotReadyComponents: () => React.ReactElement | null;\r\n  getReadyComponents: () => React.ReactElement | null;\r\n}\r\n\r\n/** Loads and manages the boussole data. Children are rendered if data is available, otherwise a \"wait\" message is being displayed. */\r\nexport const BoussoleDataStateProvider: React.FC<IBoussoleDataStateProviderProps> = ({\r\n  getNotReadyComponents,\r\n  getReadyComponents,\r\n}) => {\r\n  const boussoleDataStore = useBoussoleDataStore();\r\n  const [boussoleDataState, setBoussoleDataState] = React.useState<IBoussoleDataState | undefined>(undefined);\r\n\r\n  React.useEffect(() => {\r\n    (async () => {\r\n      const data = await boussoleDataStore.loadData();\r\n      setBoussoleDataState(new ParticleState<BoussoleData>(data));\r\n    })();\r\n  }, [boussoleDataStore]);\r\n\r\n  if (boussoleDataState === undefined) {\r\n    return <>{getNotReadyComponents()}</>;\r\n  }\r\n\r\n  return (\r\n    <BoussoleDataStateContext.Provider value={boussoleDataState!}>\r\n      {getReadyComponents()}\r\n    </BoussoleDataStateContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useBoussoleDataState = () => {\r\n  const boussoleDataState = React.useContext(BoussoleDataStateContext);\r\n  if (!boussoleDataState) {\r\n    throw new Error('Please define a BoussoleDataStateProvider upper in the component tree.');\r\n  }\r\n  return boussoleDataState;\r\n};\r\n","import React from 'react';\r\nimport { IBoussoleDataService } from './IBoussoleDataService';\r\nimport { BoussoleDataService } from './BoussoleDataService';\r\nimport { useBoussoleDataState } from '../BoussoleDataState/BoussoleDataStateProvider';\r\n\r\nconst BoussoleDataServiceContext = React.createContext<IBoussoleDataService>(undefined as any);\r\n\r\nexport const BoussoleDataServiceProvider: React.FC = ({ children }) => {\r\n  const boussoleDataState = useBoussoleDataState();\r\n  const boussoleDataService = React.useMemo(() => new BoussoleDataService(boussoleDataState), [boussoleDataState]);\r\n\r\n  return (\r\n    <BoussoleDataServiceContext.Provider value={boussoleDataService!}>{children}</BoussoleDataServiceContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useBoussoleDataService = () => {\r\n  const boussoleDataService = React.useContext(BoussoleDataServiceContext);\r\n  if (!boussoleDataService) {\r\n    throw new Error('Please define a BoussoleDataServiceProvider upper in the component tree.');\r\n  }\r\n  return boussoleDataService;\r\n};\r\n","import { Task, TaskState } from '../DataModel/Task';\n\nexport const getNewTask = (): Task => ({\n  id: '',\n  tagId: null,\n  state: 'created',\n  title: '',\n  description: '',\n  created: new Date(),\n  modified: new Date(),\n});\n\nexport const newState = (state: TaskState): Partial<Task> => {\n  return {\n    state,\n    dateClosed: state === 'finished' || state === 'abandoned' ? new Date() : undefined,\n  };\n};\n","export const getClasses = (...args: (string | null | undefined | false)[]): string => {\n  return args.filter((name) => !!name).join(' ');\n};\n","import { TaskState } from '../DataModel/Task';\n\nexport const getStateLabel = (state: TaskState): string => {\n  switch (state) {\n    case 'created':\n      return 'En attente';\n    case 'in-backlog':\n      return 'Dans le radar';\n    case 'next':\n      return 'Prochainement';\n    case 'active':\n      return 'En cours';\n    case 'finished':\n      return 'Terminée';\n    case 'abandoned':\n      return 'Abandonnée';\n  }\n};\n","import { TaskState } from '../DataModel/Task';\r\n\r\nexport type Color = {\r\n  /** red component, 0-255 */\r\n  red: number;\r\n\r\n  /** green component, 0-255 */\r\n  green: number;\r\n\r\n  /** blue component, 0-255 */\r\n  blue: number;\r\n};\r\n\r\nexport const getColor = (color: string): Color => {\r\n  if (!color.match(/^#[0-9a-fA-F]{6}$/)) {\r\n    throw new Error('invalid color');\r\n  }\r\n\r\n  return {\r\n    red: parseInt(color.substr(1, 2), 16),\r\n    green: parseInt(color.substr(3, 2), 16),\r\n    blue: parseInt(color.substr(5, 2), 16),\r\n  };\r\n};\r\n\r\nconst getHexColor = (component: number): string => {\r\n  if (component < 0) {\r\n    component = 0;\r\n  } else if (component > 255) {\r\n    component = 255;\r\n  }\r\n\r\n  return Math.round(component).toString(16).padStart(2, '0');\r\n};\r\n\r\nexport const getCssColor = (color: Color): string => {\r\n  return `#${getHexColor(color.red)}${getHexColor(color.green)}${getHexColor(color.blue)}`;\r\n};\r\n\r\nexport const mix = (color1: Color, color2: Color, coefficient: number = 0.5): Color => {\r\n  return {\r\n    red: color1.red * (1 - coefficient) + color2.red * coefficient,\r\n    green: color1.green * (1 - coefficient) + color2.green * coefficient,\r\n    blue: color1.blue * (1 - coefficient) + color2.blue * coefficient,\r\n  };\r\n};\r\n\r\n/**\r\n * Computes a darker version of a color.\r\n * @param color The initial color.\r\n * @param amount How much darker the new color must be. Ranges from 0 (unchanged) to 1 (black).\r\n */\r\nexport const darker = (color: Color, amount: number): Color => {\r\n  return {\r\n    red: color.red * (1 - amount),\r\n    green: color.green * (1 - amount),\r\n    blue: color.blue * (1 - amount),\r\n  };\r\n};\r\n\r\n/**\r\n * Computes a grayscale version of a color.\r\n * @param color The initial color.\r\n * @param amount How much gray the new color must be. Ranges from 0 (unchanged) to 1 (complete grayscale).\r\n */\r\nexport const greyscale = (color: Color, amount: number): Color => {\r\n  var grey = 0.3 * color.red + 0.59 * color.green + 0.11 * color.blue;\r\n\r\n  return {\r\n    red: color.red * (1 - amount) + grey * amount,\r\n    green: color.green * (1 - amount) + grey * amount,\r\n    blue: color.blue * (1 - amount) + grey * amount,\r\n  };\r\n};\r\n\r\nexport const TaskColors: {\r\n  [state in TaskState]: Color;\r\n} = {\r\n  created: getColor('#dadada'),\r\n  'in-backlog': getColor('#ffa9f2'),\r\n  next: getColor('#aa8afd'),\r\n  active: getColor('#66dfff'),\r\n  finished: getColor('#6eef00'),\r\n  abandoned: getColor('#999999'),\r\n};\r\n","import React, { CSSProperties } from 'react';\nimport styles from '../Tasks.module.scss';\nimport { getClasses } from '../../../Helpers/cssHelper';\nimport { TaskState } from '../../../DataModel/Task';\nimport { getStateLabel } from '../../../Helpers/textHerlper';\nimport { getCssColor, TaskColors, darker } from '../../../Helpers/Colors';\n\nexport type TaskStateDisplayProps = {\n  /** State to be rendered. */\n  state: TaskState;\n  /** Show the text. */\n  showText?: boolean;\n  /** Display a thick border. */\n  showCurrentBorder?: boolean;\n  /** Display an attenuated color. */\n  showNotCurrent?: boolean;\n  /** Display as a button and call onClick when clicked. If undefined, the control is not clickable. */\n  onClick?: () => void;\n};\n\nconst getStyle = (state: TaskState, showCurrentBorder?: boolean, showNotCurrent?: boolean): CSSProperties => {\n  return {\n    backgroundColor: getCssColor(TaskColors[state]),\n    borderColor: getCssColor(darker(TaskColors[state], 0.2)),\n  };\n};\n\n/** Shows a task state as a rounded rectangle, with a background color corresponding to the state, and optionally the state's text label. */\nexport const TaskStateIndicator: React.FC<TaskStateDisplayProps> = ({\n  state,\n  showText,\n  showCurrentBorder,\n  showNotCurrent,\n  onClick,\n}) => {\n  return (\n    <div\n      title={showText ? undefined : getStateLabel(state)}\n      className={getClasses(\n        styles.taskStateIndicator,\n        !showText && styles.small,\n        showCurrentBorder && styles.thickBorder,\n        showNotCurrent && styles.notCurrent,\n        onClick && styles.clickable\n      )}\n      style={getStyle(state, showCurrentBorder, showNotCurrent)}\n      onClick={\n        onClick\n          ? (event) => {\n              event.stopPropagation();\n              onClick();\n            }\n          : undefined\n      }\n    >\n      {showText && getStateLabel(state)}\n    </div>\n  );\n};\n","import React, { FunctionComponent } from 'react';\nimport styles from './Overlay.module.scss';\n\nexport const Overlay: FunctionComponent<{}> = ({ children }) => {\n  return <div className={styles.overlay}>{children}</div>;\n};\n","import React, { FunctionComponent } from 'react';\nimport styles from './Button.module.scss';\nimport { getClasses } from '../../../Helpers/cssHelper';\n\nexport interface ButtonProps {\n  isLight?: boolean;\n  isWide?: boolean;\n  title?: string;\n  onClick?: () => void;\n}\n\nexport const Button: FunctionComponent<ButtonProps> = ({ isLight, isWide, title, onClick, children }) => {\n  return (\n    <div\n      className={getClasses(styles.button, isLight && styles.light, isWide && styles.wide)}\n      title={title}\n      onClick={onClick}\n    >\n      {children}\n    </div>\n  );\n};\n","import React, { FunctionComponent } from 'react';\nimport styles from './Dialog.module.scss';\nimport { Overlay } from '../Overlay/Overlay';\nimport { Button } from '../Button/Button';\n\nexport interface ButtonProps {\n  text: string;\n  onclick: () => void;\n}\n\nexport interface DialogProps {\n  title?: string;\n  buttons?: ButtonProps[];\n}\n\nexport const Dialog: FunctionComponent<DialogProps> = ({ title, buttons, children }) => {\n  return (\n    <Overlay>\n      <div className={styles.dialog}>\n        {title && <div className={styles.title}>{title}</div>}\n        <div className={styles.content}>{children}</div>\n        {buttons && (\n          <div className={styles.buttons}>\n            {buttons.map((button) => (\n              <Button isWide onClick={button.onclick}>\n                {button.text}\n              </Button>\n            ))}\n          </div>\n        )}\n      </div>\n    </Overlay>\n  );\n};\n","import React from 'react';\nimport styles from '../Tasks.module.scss';\nimport spacingStyles from '../../Utility/Spacing.module.scss';\nimport { TaskState } from '../../../DataModel/Task';\nimport { TaskStateIndicator } from './TaskStateIndicator';\n\nexport type TaskStateChoiceProps = {\n  state: TaskState;\n  onChange: (state: TaskState) => void;\n};\n\n/** Shows all possible task states and enables selecting a state.\n *  Does not commit any action, but calls onChange whenever a new state is selected. */\nexport const TaskStateChoice: React.FC<TaskStateChoiceProps> = ({ state, onChange }) => {\n  const renderState = React.useCallback(\n    (buttonState: TaskState) => {\n      return (\n        <TaskStateIndicator\n          state={buttonState}\n          showText\n          showCurrentBorder={buttonState === state}\n          showNotCurrent={buttonState !== state}\n          onClick={\n            buttonState === state\n              ? undefined\n              : () => {\n                  onChange(buttonState);\n                }\n          }\n        />\n      );\n    },\n    [state, onChange]\n  );\n\n  return (\n    <div className={spacingStyles.spaceOutVerticalComponents}>\n      {renderState('created')}\n      {renderState('in-backlog')}\n      {renderState('next')}\n      {renderState('active')}\n      <div className={styles.taskStateClosed}>\n        {renderState('finished')}\n        {renderState('abandoned')}\n      </div>\n    </div>\n  );\n};\n","import React from 'react';\nimport { TaskState } from '../../../DataModel/Task';\nimport { Dialog } from '../../Utility/Dialog/Dialog';\nimport { TaskStateChoice } from './TaskStateChoice';\n\nexport type TaskStateEditionDialogProps = {\n  /** The task to be rendered. */\n  state: TaskState;\n  /** Triggered when the task is being clicked. */\n  onClose: (state?: TaskState) => void;\n};\n\n/** Edition of a task's state, displays all possible states. Calls onClose when a state is selected, or when \"Cancel\" is clicked. */\nexport const TaskStateEditionDialog: React.FunctionComponent<TaskStateEditionDialogProps> = ({ state, onClose }) => {\n  return (\n    <Dialog\n      buttons={[\n        {\n          text: 'Annuler',\n          onclick: () => {\n            onClose();\n          },\n        },\n      ]}\n    >\n      <TaskStateChoice state={state} onChange={onClose} />\n    </Dialog>\n  );\n};\n","import React, { FunctionComponent } from 'react';\nimport styles from './Field.module.scss';\n\nexport interface FieldProps {\n  label: string;\n}\n\nexport const Field: FunctionComponent<FieldProps> = ({ label, children }) => {\n  return (\n    <div className={styles.field}>\n      <div className={styles.label}>{label}</div>\n      <div>{children}</div>\n    </div>\n  );\n};\n","export type Tag = {\r\n  id: string;\r\n  name: string;\r\n};\r\n\r\nexport const AllTags: Tag[] = [\r\n  {\r\n    id: 'cp',\r\n    name: 'Conseil de paroisse',\r\n  },\r\n  {\r\n    id: 'scouts',\r\n    name: 'Scouts',\r\n  },\r\n  {\r\n    id: 'travaux',\r\n    name: 'Travaux maison',\r\n  },\r\n  {\r\n    id: 'achats',\r\n    name: 'Achats',\r\n  },\r\n  {\r\n    id: 'jardin',\r\n    name: 'Jardin',\r\n  },\r\n  {\r\n    id: 'loisirs',\r\n    name: 'Loisirs',\r\n  },\r\n  {\r\n    id: 'maison',\r\n    name: 'Entretien, rangement maison',\r\n  },\r\n  {\r\n    id: 'administration',\r\n    name: 'Administration',\r\n  },\r\n  {\r\n    id: 'vie-famille',\r\n    name: 'Vie de famille, spiritualité',\r\n  },\r\n  {\r\n    id: 'coup-d-pouce',\r\n    name: \"Coup d'Pouce\",\r\n  },\r\n  {\r\n    id: 'église',\r\n    name: 'Église, END',\r\n  },\r\n  {\r\n    id: 'pro',\r\n    name: 'Professionnel',\r\n  },\r\n];\r\n\r\nexport const getTag = (tagId: string | undefined): Tag | undefined => {\r\n  return AllTags.find((tag) => tag.id === tagId);\r\n};\r\n","import React from 'react';\r\nimport styles from './TagComponent.module.scss';\r\nimport { getClasses } from '../../Helpers/cssHelper';\r\n\r\nexport type TagControlProps = {\r\n  /** Text to be rendered in the tag. */\r\n  text: string;\r\n\r\n  /** If true, the tag is rendered with a more prominent color. */\r\n  active?: boolean;\r\n\r\n  /** If true, the tag is rendered gray instead of colored. */\r\n  noTag?: boolean;\r\n\r\n  /** If not undefined, the tag is clickable and onClick() is called when the tag is clicked. */\r\n  onClick?: () => void;\r\n\r\n  /** If not undefined, a cross is rendered, and \"onRemove\" is called when the cross is clicked. */\r\n  onRemove?: () => void;\r\n};\r\n\r\n/** Raw rendering of a tag. */\r\nexport const TagControl: React.FunctionComponent<TagControlProps> = ({ text, active, noTag, onClick, onRemove }) => {\r\n  return (\r\n    <div\r\n      className={getClasses(styles.tag, onClick && styles.clickable, active && styles.active, noTag && styles.noTag)}\r\n      onClick={\r\n        onClick\r\n          ? (ev) => {\r\n              ev.stopPropagation();\r\n              onClick!();\r\n            }\r\n          : undefined\r\n      }\r\n    >\r\n      {text}\r\n      {onRemove && (\r\n        <span\r\n          className={styles.remove}\r\n          onClick={(ev) => {\r\n            ev.stopPropagation();\r\n            onRemove!();\r\n          }}\r\n        >\r\n          X\r\n        </span>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n","import React from 'react';\r\nimport { AllTags } from '../../DataModel/Tags';\r\nimport { TagControl } from './TagControl';\r\n\r\nexport type TagComponentProps = {\r\n  /** ID of the tag to be rendered. null means \"no tag\".*/\r\n  tagId: string | null;\r\n\r\n  /** If true, the tag is rendered with a more prominent color. */\r\n  active?: boolean;\r\n\r\n  /** If defined, the tag is clickable, and onClick is called when the tag is clicked. */\r\n  onClick?: (tagId: string | null) => void;\r\n\r\n  /** If not undefined, a cross is rendered, and \"onRemove\" is called when the cross is clicked. */\r\n  onRemove?: () => void;\r\n};\r\n\r\n/** displays a tag, calls onClick when the tag is clicked (if onClick is not undefined). */\r\nexport const TagComponent: React.FunctionComponent<TagComponentProps> = ({ tagId, active, onClick, onRemove }) => {\r\n  const tag = AllTags.find((t) => t.id === tagId);\r\n  return (\r\n    <TagControl\r\n      text={tag ? tag.name : 'Pas de catégorie'}\r\n      active={active}\r\n      noTag={tagId === null}\r\n      onClick={onClick ? () => onClick(tagId) : undefined}\r\n      onRemove={onRemove}\r\n    />\r\n  );\r\n};\r\n","import React from 'react';\r\nimport { Dialog } from '../Utility/Dialog/Dialog';\r\nimport { TagComponent } from './TagComponent';\r\nimport { AllTags } from '../../DataModel/Tags';\r\n\r\nexport type TagEditionDialogProps = {\r\n  tagId: string | null | undefined;\r\n  onChange: (tagId: string | null) => void;\r\n  onClose: () => void;\r\n};\r\n\r\n/** Edition of a task's state, displays all possible states. Calls onClose when a state is selected, or when \"Cancel\" is clicked. */\r\nexport const TagEditionDialog: React.FunctionComponent<TagEditionDialogProps> = ({ tagId, onChange, onClose }) => {\r\n  var allTagIdsWithNull = React.useMemo<(string | null)[]>(() => {\r\n    const allTagIds = AllTags.map((tag) => tag.id);\r\n    if (tagId === null || tagId === undefined) {\r\n      return [null, ...allTagIds];\r\n    }\r\n    return [tagId, null, ...allTagIds.filter((id) => id !== tagId)];\r\n  }, [tagId]);\r\n\r\n  return (\r\n    <Dialog\r\n      buttons={[\r\n        {\r\n          text: 'Annuler',\r\n          onclick: () => {\r\n            onClose();\r\n          },\r\n        },\r\n      ]}\r\n    >\r\n      {allTagIdsWithNull.map((id) => (\r\n        <TagComponent tagId={id} active={id === tagId} onClick={id === tagId ? undefined : onChange} />\r\n      ))}\r\n    </Dialog>\r\n  );\r\n};\r\n","import React from 'react';\nimport { TaskStateChoice } from './TaskState/TaskStateChoice';\nimport { Field } from '../Utility/Field/Field';\nimport { newState } from '../../Helpers/tasksHelper';\nimport { Task } from '../../DataModel/Task';\nimport { TagComponent } from '../Tags/TagComponent';\nimport { TagEditionDialog } from '../Tags/TagEditionDialog';\n\nexport type TaskFormProps = {\n  task: Task;\n  onChange: (task: Task) => void;\n};\n\n/** Enables editing a task's data. Calls onChange when any change occurs. Does not have buttons. */\nexport const TaskForm: React.FC<TaskFormProps> = ({ task, onChange }) => {\n  const [tagEditFormOpen, setTagEditFormOpen] = React.useState(false);\n  return (\n    <>\n      <TaskStateChoice state={task.state} onChange={(state) => onChange({ ...task, ...newState(state) })} />\n      <Field label=\"titre\">\n        <input type=\"text\" value={task.title} onChange={(event) => onChange({ ...task, title: event.target.value })} />\n      </Field>\n      <Field label=\"catégorie\">\n        <TagComponent\n          tagId={task.tagId}\n          active\n          onClick={() => {\n            setTagEditFormOpen(true);\n          }}\n        />\n      </Field>\n      <Field label=\"description\">\n        <textarea\n          value={task.description}\n          onChange={(event) => onChange({ ...task, description: event.target.value })}\n        />\n      </Field>\n      {tagEditFormOpen && (\n        <TagEditionDialog\n          tagId={task.tagId}\n          onChange={(tagId) => {\n            onChange({ ...task, tagId });\n            setTagEditFormOpen(false);\n          }}\n          onClose={() => setTagEditFormOpen(false)}\n        />\n      )}\n    </>\n  );\n};\n","import React, { useState, useMemo } from 'react';\nimport { useBoussoleDataService } from '../../Services/BoussoleDataService/BoussoleDataServiceProvider';\nimport { getNewTask } from '../../Helpers/tasksHelper';\nimport { Task } from '../../DataModel/Task';\nimport { Dialog } from '../Utility/Dialog/Dialog';\nimport { TaskForm } from './TaskForm';\n\nexport type TaskEditionDialogProps = {\n  task: Task | undefined;\n  onClose: () => void;\n};\n\n/** Enables editing a task. Responsible for creating or updating the task. Calls onClose() when done. */\nexport function TaskEditionDialog(props: TaskEditionDialogProps) {\n  const id = useMemo(() => (props.task ? props.task.id : undefined), [props.task]);\n  const [editedTask, setEditedTask] = useState<Task>(props.task || getNewTask());\n  const { createTask, updateTask } = useBoussoleDataService();\n\n  const onSave = () => {\n    if (id) {\n      updateTask(id, editedTask);\n    } else {\n      createTask(editedTask);\n    }\n    props.onClose();\n  };\n\n  return (\n    <Dialog\n      title={id ? 'Modifier une tâche' : 'Nouvelle tâche'}\n      buttons={[\n        { text: 'Valider', onclick: onSave },\n        { text: 'Annuler', onclick: props.onClose },\n      ]}\n    >\n      <TaskForm task={editedTask} onChange={setEditedTask} />\n    </Dialog>\n  );\n}\n","import React from 'react';\nimport styles from './Tasks.module.scss';\nimport { useBoussoleDataService } from '../../Services/BoussoleDataService/BoussoleDataServiceProvider';\nimport { newState } from '../../Helpers/tasksHelper';\nimport { Task } from '../../DataModel/Task';\nimport { TaskStateIndicator } from './TaskState/TaskStateIndicator';\nimport { TaskStateEditionDialog } from './TaskState/TaskStateEditionDialog';\nimport { TaskEditionDialog } from './TaskEditionDialog';\n\nexport type TaskComponentProps = {\n  /** The task to be rendered. */\n  task: Task;\n};\n\n/** Renders a single task in the list of tasks. */\nexport const TaskComponent: React.FunctionComponent<TaskComponentProps> = ({ task }) => {\n  const { updateTask } = useBoussoleDataService();\n  const [taskEditDialogOpen, setTaskEditDialogOpen] = React.useState(false);\n  const [stateEditDialogOpen, setStateEditDialogOpen] = React.useState(false);\n\n  return (\n    <>\n      <div onClick={() => setTaskEditDialogOpen(true)} className={styles.task}>\n        <div className={styles.title}>{task.title}</div>\n        <TaskStateIndicator state={task.state} onClick={() => setStateEditDialogOpen(true)} />\n      </div>\n      {taskEditDialogOpen && <TaskEditionDialog task={task} onClose={() => setTaskEditDialogOpen(false)} />}\n      {stateEditDialogOpen && (\n        <TaskStateEditionDialog\n          state={task.state}\n          onClose={(state) => {\n            setStateEditDialogOpen(false);\n            if (state) updateTask(task.id, newState(state));\n          }}\n        />\n      )}\n    </>\n  );\n};\n","import React from 'react';\r\nimport { BoussoleData } from '../../DataModel/BoussoleData';\r\nimport { useBoussoleDataState } from '../BoussoleDataState/BoussoleDataStateProvider';\r\n\r\nconst BoussoleDataContext = React.createContext<BoussoleData>(undefined as any);\r\n\r\nexport const BoussoleDataProvider: React.FC = ({ children }) => {\r\n  var boussoleDataState = useBoussoleDataState();\r\n  const [boussoleData, setBoussoleData] = React.useState<BoussoleData>(boussoleDataState.getState());\r\n\r\n  React.useEffect(() => boussoleDataState.subscribe(setBoussoleData), [boussoleDataState]);\r\n\r\n  return <BoussoleDataContext.Provider value={boussoleData}>{children}</BoussoleDataContext.Provider>;\r\n};\r\n\r\nexport const useBoussoleData = () => {\r\n  const boussoleData = React.useContext(BoussoleDataContext);\r\n  if (!boussoleData) {\r\n    throw new Error('Please define a BoussoleDataProvider upper in the component tree.');\r\n  }\r\n  return boussoleData;\r\n};\r\n","import React from 'react';\nexport const SaveImage = (props: React.SVGProps<SVGSVGElement>) => (\n  <svg\n    xmlns=\"http://www.w3.org/2000/svg\"\n    shapeRendering=\"geometricPrecision\"\n    textRendering=\"geometricPrecision\"\n    imageRendering=\"optimizeQuality\"\n    fillRule=\"evenodd\"\n    clipRule=\"evenodd\"\n    viewBox=\"0 0 640 640\"\n    {...props}\n  >\n    <path d=\"M626.689 15.414zm-55.654 574.472v.011H459.336c-2.09 0-3.79-1.689-3.79-3.767V416.97l-.013-.508c0-4.701-.862-8.599-2.575-11.587a23.657 23.657 0 0 0-1.05-1.618 13.646 13.646 0 0 0-1.23-1.394l-.105-.13c-1.571-1.559-3.544-2.764-5.859-3.59l-1.287-.39-.201-.071h-.035c-2.15-.579-4.571-.874-7.205-.886h-.26l-.402-.012H204.262c-4.618 0-8.433.886-11.35 2.528l-.095.07-1.382.875-.212.189c-.485.354-.957.791-1.394 1.193l-.083.094-.035.036c-3.213 3.271-4.82 8.197-4.82 14.705l-.023.2V586.13h-.012c0 2.08-1.724 3.756-3.78 3.756h-63.874a3.744 3.744 0 0 1-2.681-1.11l-62.906-62.894a3.901 3.901 0 0 1-1.512-3.083V69.474l-.024-.402c0-4.323.78-7.949 2.292-10.795h.011c.284-.555.58-1.016.898-1.5l.13-.166a9.743 9.743 0 0 1 1.3-1.535l.046-.083.13-.13h.012c1.323-1.322 2.965-2.35 4.82-3.094l.188-.095.095-.035.082-.06.945-.318v.012l.071-.036c2.197-.708 4.713-1.05 7.512-1.11l.46-.035h54.202c2.079 0 3.791 1.689 3.791 3.767v227.436c0 2.729.237 5.35.697 7.796a36.732 36.732 0 0 0 2.02 6.992l.07.106.013.036v.012a38.87 38.87 0 0 0 3.472 6.52c1.347 2.019 2.894 4.027 4.713 5.905l.118.094.023.036.036.012a38.841 38.841 0 0 0 8.433 6.638l.06.011.07.024.07.035 1.678.886.024.012 2.09.933v.012l.036.012.012.012h.035v.011c1.713.709 3.472 1.347 5.232 1.784h.036l.165.023.047.012h.178l1.346.284v.012c2.362.448 4.854.708 7.382.732l.106-.012h309.181c5.386 0 10.323-.933 14.847-2.787l.07-.048c4.536-1.866 8.682-4.677 12.473-8.421l.142-.177c1.866-1.878 3.579-3.91 4.996-6.024a36.432 36.432 0 0 0 3.45-6.342l.011-.06.035-.059.036-.118a35.794 35.794 0 0 0 2.138-6.98l.023-.142c.46-2.457.685-5.067.685-7.772V53.871c0-2.079 1.725-3.78 3.827-3.78h53.765c3.047 0 5.693.367 8.008 1.075 2.492.78 4.618 2.032 6.26 3.674 1.346 1.334 2.433 3.023 3.189 4.972l-.024.012.07.095.32.909h-.024l.06.13c.72 2.138 1.05 4.654 1.11 7.406l.047.448v.284l-.024.082v501.727c0 2.906-.378 5.587-1.075 7.855l-.059.165v.012l-.012.118-.413 1.122h-.012l-.118.296-.472 1.039-.071.2-.13.213-.012-.012-.154.308-.755 1.169h-.012l-.26.401-.732.898-.32.354c-.767.815-1.7 1.56-2.74 2.186a17.6 17.6 0 0 1-2.881 1.358l-.331.118c-.839.283-1.76.52-2.74.72l-.095.012-.059.012-.094.024-.45.07-.106.024h-.023l-.083.012c-1.17.165-2.54.283-3.957.307h-.696zM467.912 51.155l-296.248-1.063V262.42h-.024c0 2.386.295 4.465.886 6.272.154.295.224.543.343.78a10.107 10.107 0 0 0 2.078 3.153l.154.142v.011c.295.296.59.544.874.768.307.26.697.496 1.063.709 2.055 1.193 4.795 1.76 8.232 1.76v.011l269 1.312v-.012h.023v.012c4.724 0 8.197-1.099 10.346-3.308 2.186-2.22 3.284-5.716 3.296-10.535h-.024V51.155zM221.177 426.502h79.23v.023c1.842 0 3.377 1.5 3.377 3.343V586.53c0 1.843-1.535 3.367-3.378 3.367h-79.23v-.012c-1.83 0-3.365-1.512-3.365-3.355V429.868c0-1.842 1.535-3.366 3.366-3.366zm405.596 197.672zm-576.15-622h543.55c6.355 0 12.237 1.122 17.67 3.342l2.646 1.17c4.394 2.137 8.469 5.066 12.272 8.799l3.39 3.85 2.929 4.075c4.594 7.217 6.933 15.425 6.933 24.591v543.538c0 6.33-1.122 12.225-3.354 17.693-2.21 5.445-5.516 10.418-9.922 14.988a46.306 46.306 0 0 1-7.724 6.32l-1.323.885a40.453 40.453 0 0 1-5.823 2.989c-5.457 2.29-11.35 3.413-17.705 3.413H90.475l-1.276-1.287-83.576-83.576-5.48-3.638V47.846C-1.7 27.544 14.683 7.89 32.907 5.493c5.469-2.209 11.374-3.319 17.717-3.319z\" />\n  </svg>\n);\n","import React from 'react';\nimport styles from './App.module.scss';\nimport { Link } from 'react-router-dom';\nimport { SaveImage } from '../../Assets/SaveImage';\nimport { getClasses } from '../../Helpers/cssHelper';\nimport { useAutoSaver } from '../../Services/AutoSaver/AutoSaver';\n\ntype PageLayoutProps = {\n  /** optional header controls to be rendered */\n  headerControls?: React.ReactElement;\n};\n\n/** renders a header with various buttons and the children as the content */\nexport const PageLayout: React.FunctionComponent<PageLayoutProps> = ({ headerControls, children }) => {\n  var saveStatus = useAutoSaver();\n\n  return (\n    <>\n      <header>\n        <Link to=\"/editor-analysis\">Analyse éditeur</Link>\n        <Link to=\"/editor-test\">Test éditeur</Link>\n        <Link to=\"/home\">Home</Link>\n        <Link to=\"/tasks\">Tâches</Link>\n        <span\n          title={saveStatus === 'saving' ? \"En cours d'enregistrement...\" : 'Toutes les données sont sauvegardées.'}\n        >\n          <SaveImage\n            className={getClasses(styles.saveButton, saveStatus === 'saving' && styles.saving)}\n            height={20}\n            width={20}\n          />\n        </span>\n        {headerControls}\n      </header>\n      <section>{children}</section>\n    </>\n  );\n};\n","import React from 'react';\r\nimport { BoussoleData } from '../../DataModel/BoussoleData';\r\nimport { AutoSaverStatus } from './AutoSaverStatus';\r\nimport { useBoussoleDataStore } from '../BoussoleDataStore/BoussoleDataStoreProvider';\r\nimport { useBoussoleDataState } from '../BoussoleDataState/BoussoleDataStateProvider';\r\n\r\ntype AutoSaverState = {\r\n  // the model being saved. Undefined if no model needs to be saved.\r\n  modelBeingSaved?: BoussoleData;\r\n  // A model queued to be saved, if a save operation is already ongoing (modelBeingSaved is thus not undefined), undefined otherwise.\r\n  modelToSave?: BoussoleData;\r\n};\r\n\r\nexport const useAutoSaver = (): AutoSaverStatus => {\r\n  const boussoleDataStore = useBoussoleDataStore();\r\n  const boussoleDataState = useBoussoleDataState();\r\n  const state = React.useRef<AutoSaverState>({});\r\n  const [saveStatus, setSaveStatus] = React.useState<AutoSaverStatus>('all-saved');\r\n\r\n  const onModelChange = React.useCallback(\r\n    (model: BoussoleData) => {\r\n      if (state.current.modelBeingSaved) {\r\n        // a save operation is already ongoing. Queue the model to be saved, overwriting an older version already queued (if any).\r\n        state.current.modelToSave = model;\r\n        return;\r\n      }\r\n\r\n      (async () => {\r\n        state.current = { modelBeingSaved: model };\r\n        setSaveStatus('saving');\r\n        await boussoleDataStore.saveData(model);\r\n\r\n        while (state.current.modelToSave) {\r\n          state.current = { modelBeingSaved: model };\r\n          await boussoleDataStore.saveData(model);\r\n        }\r\n\r\n        state.current = {};\r\n        setSaveStatus('all-saved');\r\n      })();\r\n    },\r\n    [boussoleDataStore]\r\n  );\r\n\r\n  React.useEffect(() => boussoleDataState.subscribe(onModelChange), [boussoleDataState, onModelChange]);\r\n  return saveStatus;\r\n};\r\n","import React from 'react';\nexport const FilterImage = (props: React.SVGProps<SVGSVGElement>) => (\n  <svg {...props} viewBox=\"0 0 10 10\">\n    <path\n      d=\"M 0.25,1.5 4.25,6 v 3.75 H 5.75 V 6 l 4,-4.5 v -1.25 l -9.5,0 z\"\n      fill=\"none\"\n      strokeWidth={0.5}\n      strokeLinecap=\"butt\"\n      strokeLinejoin=\"miter\"\n      strokeMiterlimit={4}\n    />\n  </svg>\n);\n","import React from 'react';\nimport styles from './Tasks.module.scss';\nimport { getClasses } from '../../Helpers/cssHelper';\nimport { TagControl } from '../Tags/TagControl';\nimport { TagEditionDialog } from '../Tags/TagEditionDialog';\nimport { TagComponent } from '../Tags/TagComponent';\n\nexport type TaskFilterValue = {\n  text: string;\n  /** tasks with that ID must be displayed. null means \"tasks with no tag\". undefined means \"do not filter on tag\". */\n  tagId: string | undefined | null;\n};\n\ntype TaskFilterProps = {\n  visible: boolean;\n  value: TaskFilterValue;\n  onChange: (filter: TaskFilterValue) => void;\n};\n\nexport const TaskFilter: React.FunctionComponent<TaskFilterProps> = ({ visible, value, onChange }) => {\n  var textRef = React.useRef<HTMLInputElement | null>(null);\n  const [tagEditFormOpen, setTagEditFormOpen] = React.useState(false);\n\n  React.useEffect(() => {\n    if (visible && textRef.current) {\n      textRef.current.focus();\n    }\n  }, [visible]);\n\n  return (\n    <div className={getClasses(styles.tasksFilter, visible && styles.visible)}>\n      <div className={styles.tasksFilterInner}>\n        <input\n          ref={textRef}\n          className={styles.taskFilterText}\n          value={value.text}\n          onChange={(ev) => onChange({ ...value, text: ev.target.value })}\n        />\n        {value.tagId === undefined ? (\n          <TagControl text=\"...\" noTag onClick={() => setTagEditFormOpen(true)} />\n        ) : (\n          <TagComponent\n            tagId={value.tagId}\n            active\n            onClick={() => setTagEditFormOpen(true)}\n            onRemove={() => onChange({ ...value, tagId: undefined })}\n          />\n        )}\n      </div>\n      {tagEditFormOpen && (\n        <TagEditionDialog\n          tagId={value.tagId}\n          onChange={(tagId) => {\n            onChange({ ...value, tagId });\n            setTagEditFormOpen(false);\n          }}\n          onClose={() => setTagEditFormOpen(false)}\n        />\n      )}\n    </div>\n  );\n};\n","import React from 'react';\nimport styles from './Tasks.module.scss';\nimport { TaskComponent } from './TaskComponent';\nimport { TaskEditionDialog } from './TaskEditionDialog';\nimport { BoussoleData } from '../../DataModel/BoussoleData';\nimport { useBoussoleData } from '../../Services/BoussoleData/BoussoleDataProvider';\nimport { Task, TaskState } from '../../DataModel/Task';\nimport { Button } from '../Utility/Button/Button';\nimport { PageLayout } from '../App/PageLayout';\nimport { FilterImage } from '../../Assets/FilterImage';\nimport { TaskFilter, TaskFilterValue } from './TaskFilter';\n\nfunction getStateOrder(state: TaskState): number {\n  switch (state) {\n    case 'active':\n      return 0;\n    case 'next':\n      return 1;\n    case 'in-backlog':\n      return 2;\n    case 'created':\n      return 3;\n    case 'finished':\n      return 4;\n    case 'abandoned':\n      return 5;\n  }\n}\n\nfunction compare(task1: Task, task2: Task): number {\n  if (task1.state !== task2.state) {\n    return getStateOrder(task1.state) < getStateOrder(task2.state) ? -1 : 1;\n  }\n\n  // both tasks have the same state\n\n  return task1.title.localeCompare(task2.title);\n}\n\nfunction toComparable(text: string): string {\n  return text\n    .toLowerCase()\n    .normalize('NFD')\n    .replace(/[\\u0300-\\u036f]/g, '');\n}\n\nfunction sortAndFilterTasks(boussoleData: BoussoleData, filter?: TaskFilterValue): Task[] {\n  var result = Object.keys(boussoleData)\n    .map((id) => boussoleData[id])\n    .sort(compare);\n\n  if (filter) {\n    const text = filter.text ? toComparable(filter.text) : undefined;\n    result = result.filter((task) => {\n      if (text && !toComparable(task.title).includes(text) && !toComparable(task.description).includes(text)) {\n        return false;\n      }\n\n      if (filter.tagId !== undefined && task.tagId !== filter.tagId) {\n        return false;\n      }\n\n      return true;\n    });\n  }\n\n  return result;\n}\n\n/** page with the list of tasks, a filter, a \"new task\" button and an edition dialog, if needed. */\nexport function TaskList() {\n  var boussoleData = useBoussoleData();\n  const [filterVisible, setFilterVisible] = React.useState<boolean>(false);\n  const [filterValue, setFilterValue] = React.useState<TaskFilterValue>({ text: '', tagId: undefined });\n  const [newTaskFormOpen, setNewTaskFormOpen] = React.useState(false);\n\n  /*React.useEffect(() => {\n    (async () => {\n      try {\n        setData(await getData());\n      } catch (error) {\n        setData(error.toString());\n      }\n    })();\n  }, []);*/\n\n  return (\n    <PageLayout\n      headerControls={\n        <Button onClick={() => setFilterVisible(!filterVisible)} isLight={true} title=\"Filtrer\">\n          <FilterImage height={20} width={20} stroke=\"white\" />\n        </Button>\n      }\n    >\n      <div className={styles.taskList}>\n        <TaskFilter visible={filterVisible} value={filterValue} onChange={setFilterValue} />\n        <div className={styles.tasks}>\n          {sortAndFilterTasks(boussoleData, filterVisible ? filterValue : undefined).map((task) => (\n            <TaskComponent key={task.id} task={task} />\n          ))}\n        </div>\n        <div className={styles.tasksButtons}>\n          <Button isWide onClick={() => setNewTaskFormOpen(true)}>\n            +\n          </Button>\n        </div>\n        {newTaskFormOpen && <TaskEditionDialog task={undefined} onClose={() => setNewTaskFormOpen(false)} />}\n      </div>\n    </PageLayout>\n  );\n}\n","import React from 'react';\nimport styles from './IconDesigner.module.scss';\n\nexport interface IIconPreviewProps {\n  svg: string;\n  size: number;\n}\n\nexport const IconPreview: React.FunctionComponent<IIconPreviewProps> = ({ svg, size }) => {\n  return (\n    <div className={styles.iconPreview}>\n      <div\n        dangerouslySetInnerHTML={{ __html: svg }}\n        style={{\n          height: size,\n          width: size,\n        }}\n      />\n    </div>\n  );\n};\n","import React from 'react';\nimport styles from './IconDesigner.module.scss';\nimport { IconPreview } from './IconPreview';\n\nexport const IconDesigner: React.FunctionComponent = () => {\n  var [svgValue, setSvgValue] = React.useState('');\n\n  return (\n    <div className={styles.iconDesigner}>\n      <textarea value={svgValue} onChange={(ev) => setSvgValue(ev.target.value)} />\n      <IconPreview svg={svgValue} size={200} />\n      <IconPreview svg={svgValue} size={100} />\n      <IconPreview svg={svgValue} size={50} />\n      <IconPreview svg={svgValue} size={32} />\n      <IconPreview svg={svgValue} size={25} />\n    </div>\n  );\n};\n","export type PhrasingPart = {\r\n  /** text of the part. May be empty. */\r\n  text: string;\r\n  href?: string;\r\n  strong?: boolean;\r\n  em?: boolean;\r\n};\r\n\r\nexport type Block = {\r\n  type: 'ul' | 'ol' | 'p';\r\n  /** parts of the block. There is always at least one part in a block. May be empty only if there is a single part in the block. */\r\n  parts: PhrasingPart[];\r\n};\r\n\r\nexport type Position = {\r\n  blockIndex: number;\r\n  charIndex: number;\r\n};\r\n\r\nexport type TextEditorSelection = {\r\n  // element path to the start of the selection.\r\n  start: Position;\r\n  // element path to the end of the selection. Always equal to or after start. Same object as start (===) if there is a cursor and no selection (=> if the selection is collapsed).\r\n  end: Position;\r\n};\r\n\r\nexport type TextEditorState = {\r\n  blocks: Block[];\r\n  selection: TextEditorSelection | null;\r\n};\r\n\r\nexport const TestTextEditorState: TextEditorState = {\r\n  blocks: [\r\n    {\r\n      type: 'p',\r\n      parts: [\r\n        { text: 'This is a complete test with ' },\r\n        { text: 'a hyperlink', href: 'https://www.google.ch' },\r\n        { text: ', some ' },\r\n        { text: 'strong text', strong: true },\r\n        { text: ' and some ' },\r\n        { text: 'emphasized text', em: true },\r\n        { text: '. Even some text which is ' },\r\n        {\r\n          text: 'a strong and emphasized hyperlink',\r\n          href: 'https://www.google.ch, strong: true ',\r\n          strong: true,\r\n          em: true,\r\n        },\r\n        { text: '.' },\r\n      ],\r\n    },\r\n    {\r\n      type: 'ul',\r\n      parts: [{ text: 'We also have a bullet' }],\r\n    },\r\n    {\r\n      type: 'ul',\r\n      parts: [\r\n        { text: 'And another one with a ' },\r\n        { text: 'link to the ', href: 'https://www.sbb.ch' },\r\n        { text: 'SBB website', href: 'https://www.sbb.ch', strong: true },\r\n        { text: '.' },\r\n      ],\r\n    },\r\n    {\r\n      type: 'p',\r\n      parts: [{ text: 'And finally...' }],\r\n    },\r\n    {\r\n      type: 'ol',\r\n      parts: [{ text: 'An ordered list' }],\r\n    },\r\n    {\r\n      type: 'ol',\r\n      parts: [{ text: 'With two points.' }],\r\n    },\r\n  ],\r\n  selection: null,\r\n};\r\n\r\n/** Update one of the phrasing parts in an array of phrasing parts. Returns a new array. */\r\nconst replacePart = (parts: PhrasingPart[], partIndex: number, newPart: PhrasingPart): PhrasingPart[] => {\r\n  if (partIndex >= parts.length) {\r\n    console.warn(`updating part ${partIndex} but there are only ${parts.length} parts.`);\r\n    return parts;\r\n  }\r\n\r\n  return parts.map((part, index) => (index === partIndex ? newPart : part));\r\n};\r\n\r\nconst countCharacters = (block: Block): number => {\r\n  return block.parts.reduce((total, part) => total + part.text.length, 0);\r\n};\r\n\r\n/** Update the phrasing parts of one of the blocks in an array of blocks. Returns a new array.  */\r\nconst replaceBlock = (blocks: Block[], blockIndex: number, newBlock: Block): Block[] => {\r\n  if (blockIndex >= blocks.length) {\r\n    console.warn(`updating block ${blockIndex} but there are only ${blocks.length} blocks.`);\r\n    return blocks;\r\n  }\r\n\r\n  return blocks.map((block, index) => (index === blockIndex ? newBlock : block));\r\n};\r\n\r\n/** Append a part to an array of phrasing parts and merge the text to the last part if they are compatible (returns a new array). */\r\nexport const appendPart = (parts: PhrasingPart[], part: PhrasingPart): PhrasingPart[] => {\r\n  if (parts.length === 0) {\r\n    parts.push(part);\r\n  } else {\r\n    const previousPart = parts[parts.length - 1];\r\n    if (previousPart.em !== part.em || previousPart.href !== part.href || previousPart.strong !== part.strong) {\r\n      parts.push(part);\r\n    } else {\r\n      parts.splice(parts.length - 1, 1, { ...previousPart, text: previousPart.text + part.text });\r\n    }\r\n  }\r\n  return parts;\r\n};\r\n\r\n/** returns part of a block, from character start (or the start of the block if undefined) until character end (or the end of the block if undefined). */\r\nexport const subBlock = (block: Block, start?: number, end?: number): Block => {\r\n  const result: Block = { type: block.type, parts: [] };\r\n\r\n  let partStart = 0;\r\n  for (let partIndex = 0; partIndex < block.parts.length; partIndex++) {\r\n    const part = block.parts[partIndex];\r\n    const partEnd = partStart + part.text.length;\r\n\r\n    if ((start === undefined || start <= partStart) && (end === undefined || end >= partEnd)) {\r\n      // the block is included entirely\r\n      result.parts.push(part);\r\n    } else if ((start !== undefined && start >= partEnd) || (end !== undefined && end <= partStart)) {\r\n      // the block is excluded entirely\r\n    } else {\r\n      // the block must be kept partly.\r\n\r\n      let text = part.text;\r\n\r\n      if (end !== undefined && end < partEnd) {\r\n        // the text on the right must be removed\r\n        text = part.text.substring(0, end - partStart);\r\n      }\r\n\r\n      if (start !== undefined && start > partStart) {\r\n        // the text on the left must be removed\r\n        text = part.text.substr(start - partStart);\r\n      }\r\n\r\n      result.parts.push({ ...part, text });\r\n    }\r\n\r\n    partStart += part.text.length;\r\n  }\r\n\r\n  if (result.parts.length === 0) {\r\n    result.parts.push({ text: '' });\r\n  }\r\n\r\n  return result;\r\n};\r\n\r\n/** Merge several blocks together, keeping the type of the first block. Merges the last part of a block with the first part of the next block if they are compatible. Returns a new block. */\r\nexport const mergeBlocks = (...blocks: Block[]): Block => {\r\n  if (blocks.length === 0) {\r\n    throw new Error('There must be at least one block to merge.');\r\n  }\r\n\r\n  const result: Block = { ...blocks[0], parts: [...blocks[0].parts] };\r\n\r\n  for (let i = 1; i < blocks.length; i++) {\r\n    var block = blocks[i];\r\n    if (block.parts.length > 0) {\r\n      appendPart(result.parts, block.parts[0]);\r\n      result.parts.push(...blocks[i].parts.slice(1));\r\n    }\r\n  }\r\n\r\n  return result;\r\n};\r\n\r\n/** clears the selected text. */\r\nexport const clearSelection = (state: TextEditorState): TextEditorState => {\r\n  if (!state.selection || state.selection.start === state.selection.end) {\r\n    return state;\r\n  }\r\n\r\n  const { start, end } = state.selection;\r\n\r\n  const blocks: Block[] = state.blocks.slice(0, start.blockIndex);\r\n\r\n  const partialBlocks: Block[] = [];\r\n\r\n  for (let blockIndex = start.blockIndex; blockIndex <= end.blockIndex; blockIndex++) {\r\n    if (blockIndex > start.blockIndex && blockIndex < end.blockIndex) {\r\n      // The whole block is inside the selection and left out completely\r\n      continue;\r\n    }\r\n\r\n    // The block is on the selection start and/or selection end.\r\n\r\n    const block = state.blocks[blockIndex];\r\n\r\n    if (blockIndex === start.blockIndex) {\r\n      partialBlocks.push(subBlock(block, undefined, start.charIndex));\r\n    }\r\n\r\n    if (blockIndex === end.blockIndex) {\r\n      partialBlocks.push(subBlock(block, end.charIndex, undefined));\r\n    }\r\n  }\r\n\r\n  blocks.push(mergeBlocks(...partialBlocks));\r\n  blocks.push(...state.blocks.slice(end.blockIndex + 1));\r\n\r\n  return {\r\n    blocks,\r\n    selection: { start, end: start },\r\n  };\r\n};\r\n\r\n/** Insert typed text in the state, deleting the selection if there is one. */\r\nexport const textTyped = (state: TextEditorState, text: string): TextEditorState => {\r\n  if (!state.selection) {\r\n    return state;\r\n  }\r\n\r\n  if (state.selection.start !== state.selection.end) {\r\n    state = clearSelection(state);\r\n  }\r\n\r\n  const blockIndex = state.selection!.start.blockIndex;\r\n  const charIndex = state.selection!.start.charIndex;\r\n  const block = state.blocks[blockIndex];\r\n\r\n  let partIndex = 0;\r\n  let partCharIndex = charIndex;\r\n  let part = block.parts[0];\r\n\r\n  // find the part where the text must be added and the position where the text must be added.\r\n  while (true) {\r\n    if (part.text.length >= partCharIndex) break;\r\n    partCharIndex -= part.text.length;\r\n    part = block.parts[++partIndex];\r\n  }\r\n\r\n  const updatedParts = replacePart(block.parts, partIndex, {\r\n    ...part,\r\n    text: part.text.substr(0, partCharIndex) + text + part.text.substr(partCharIndex),\r\n  });\r\n\r\n  const position: Position = {\r\n    blockIndex: blockIndex,\r\n    charIndex: charIndex + text.length,\r\n  };\r\n\r\n  return {\r\n    blocks: replaceBlock(state.blocks, blockIndex, { type: block.type, parts: updatedParts }),\r\n    selection: { start: position, end: position },\r\n  };\r\n};\r\n\r\n/** Effect of the \"backspace\" key. */\r\nexport const deleteContentBackward = (state: TextEditorState): TextEditorState => {\r\n  if (!state.selection) return state;\r\n\r\n  if (state.selection.start !== state.selection.end) {\r\n    // there is a selection; we clear it\r\n    return clearSelection(state);\r\n  }\r\n\r\n  const { blockIndex, charIndex } = state.selection.start;\r\n  const block = state.blocks[blockIndex];\r\n\r\n  if (charIndex > 0) {\r\n    // the cursor is not at the left of the block; we delete the character on its left.\r\n    const updatedBlock = mergeBlocks(subBlock(block, undefined, charIndex - 1), subBlock(block, charIndex));\r\n    const cursorPos = { blockIndex, charIndex: charIndex - 1 };\r\n    return {\r\n      blocks: replaceBlock(state.blocks, blockIndex, updatedBlock),\r\n      selection: { start: cursorPos, end: cursorPos },\r\n    };\r\n  }\r\n\r\n  if (blockIndex === 0) {\r\n    // the cursor is at the start of the text; we don't do anything.\r\n    return state;\r\n  }\r\n\r\n  // the cursor is at the left of the block; we merge the block with the previous one.\r\n  var newBlocks = [...state.blocks];\r\n  var previousBlock = state.blocks[blockIndex - 1];\r\n  const updatedBlock = mergeBlocks(previousBlock, block);\r\n  newBlocks.splice(blockIndex - 1, 2, updatedBlock);\r\n  const cursorPos = {\r\n    blockIndex: blockIndex - 1,\r\n    charIndex: countCharacters(previousBlock),\r\n  };\r\n  return {\r\n    blocks: newBlocks,\r\n    selection: { start: cursorPos, end: cursorPos },\r\n  };\r\n};\r\n\r\n/** Effect of the \"del\" key. */\r\nexport const deleteContentForward = (state: TextEditorState): TextEditorState => {\r\n  if (!state.selection) return state;\r\n\r\n  if (state.selection.start !== state.selection.end) {\r\n    // there is a selection; we clear it\r\n    return clearSelection(state);\r\n  }\r\n\r\n  const { blockIndex, charIndex } = state.selection.start;\r\n  const block = state.blocks[blockIndex];\r\n  const blockLength = countCharacters(block);\r\n\r\n  if (charIndex < blockLength) {\r\n    // the cursor is not at the right of the block; we delete the character on its right.\r\n    const updatedBlock = mergeBlocks(subBlock(block, undefined, charIndex), subBlock(block, charIndex + 1));\r\n    return {\r\n      blocks: replaceBlock(state.blocks, blockIndex, updatedBlock),\r\n      selection: state.selection,\r\n    };\r\n  }\r\n\r\n  if (blockIndex === state.blocks.length - 1) {\r\n    // the cursor is at the end of the text; we don't do anything.\r\n    return state;\r\n  }\r\n\r\n  // the cursor is at the right of the block; we merge the block with the next one.\r\n  var newBlocks = [...state.blocks];\r\n  const updatedBlock = mergeBlocks(state.blocks[blockIndex], state.blocks[blockIndex + 1]);\r\n  newBlocks.splice(blockIndex, 2, updatedBlock);\r\n  return {\r\n    blocks: newBlocks,\r\n    selection: state.selection,\r\n  };\r\n};\r\n\r\nexport const insertParagraph = (state: TextEditorState): TextEditorState => {\r\n  if (!state.selection) return state;\r\n\r\n  if (state.selection.start !== state.selection.end) {\r\n    // there is a selection; we clear it\r\n    state = clearSelection(state);\r\n  }\r\n\r\n  const { blockIndex, charIndex } = state.selection!.start;\r\n  const block = state.blocks[blockIndex];\r\n\r\n  const firstBlock = subBlock(block, undefined, charIndex);\r\n  const secondBlock = subBlock(block, charIndex);\r\n\r\n  var newBlocks = [...state.blocks];\r\n  newBlocks.splice(blockIndex, 1, firstBlock, secondBlock);\r\n\r\n  const newPosition: Position = {\r\n    blockIndex: blockIndex + 1,\r\n    charIndex: 0,\r\n  };\r\n\r\n  return {\r\n    blocks: newBlocks,\r\n    selection: { start: newPosition, end: newPosition },\r\n  };\r\n};\r\n","import React, { ReactElement, Fragment } from 'react';\r\nimport styles from './TextEditor.module.scss';\r\nimport {\r\n  TextEditorState,\r\n  TestTextEditorState,\r\n  TextEditorSelection,\r\n  PhrasingPart,\r\n  Position,\r\n  deleteContentBackward,\r\n  textTyped,\r\n  deleteContentForward,\r\n  insertParagraph,\r\n} from './TextEditorState';\r\n\r\n/** Recursively count characters of a node and its sub-nodes. */\r\nconst countCharacters = (node: Node): number => {\r\n  if (node.nodeType === Node.TEXT_NODE) {\r\n    return node.textContent!.length;\r\n  }\r\n\r\n  var length = 0;\r\n\r\n  if (node.hasChildNodes) {\r\n    var children = node.childNodes;\r\n\r\n    for (var i = 0; i < children.length; i++) {\r\n      length += countCharacters(children[i]);\r\n    }\r\n  }\r\n\r\n  return length;\r\n};\r\n\r\n/** Compute the model position corresponding to a browser selection focus or anchor position */\r\nconst computePosition = (rootElement: HTMLElement, node: Node, offset: number): Position => {\r\n  let charIndex = offset;\r\n\r\n  if (node === rootElement) {\r\n    return { blockIndex: 0, charIndex: 0 };\r\n  }\r\n\r\n  // build a list with all nodes of the hierarchy from node (included) to rootElement (excluded)\r\n\r\n  let nodes: Node[] = [node];\r\n  let parentElement = node.parentElement!;\r\n  while (true) {\r\n    if (parentElement === rootElement) {\r\n      break;\r\n    }\r\n\r\n    nodes.push(parentElement);\r\n    parentElement = parentElement.parentElement!;\r\n  }\r\n\r\n  // find out the block index and remove the element(s) which are part of the block\r\n\r\n  let blockIndex = 0;\r\n  let firstLevelElement: Node | null;\r\n\r\n  if (nodes[nodes.length - 1].nodeName.toLowerCase() === 'p') {\r\n    [firstLevelElement] = nodes.splice(nodes.length - 1);\r\n  } else {\r\n    // ol or ul, blockIndex depends on the li within the list.\r\n\r\n    if (nodes.length === 1) {\r\n      [firstLevelElement] = nodes.splice(nodes.length - 1);\r\n    } else {\r\n      let li: Node | null;\r\n      [li, firstLevelElement] = nodes.splice(nodes.length - 2);\r\n      let sibling = li.previousSibling;\r\n      while (sibling) {\r\n        blockIndex++;\r\n        sibling = sibling.previousSibling;\r\n      }\r\n    }\r\n  }\r\n\r\n  firstLevelElement = firstLevelElement.previousSibling;\r\n  while (firstLevelElement) {\r\n    if (firstLevelElement.nodeName.toLowerCase() === 'p') {\r\n      blockIndex++;\r\n    } else {\r\n      if (firstLevelElement.hasChildNodes) {\r\n        blockIndex += firstLevelElement.childNodes.length;\r\n      }\r\n    }\r\n    firstLevelElement = firstLevelElement.previousSibling;\r\n  }\r\n\r\n  // count the charIndex within the elements which are part of the phrasing.\r\n\r\n  for (let i = 0; i < nodes.length; i++) {\r\n    let sibling = nodes[i].previousSibling;\r\n    while (sibling) {\r\n      if (sibling) {\r\n        charIndex += countCharacters(sibling);\r\n      }\r\n      sibling = sibling.previousSibling;\r\n    }\r\n  }\r\n\r\n  return { blockIndex, charIndex };\r\n};\r\n\r\n/** Compute the model selection corresponding to a browser selection */\r\nconst computeSelection = (rootElement: HTMLElement, selection: Selection | null): TextEditorSelection | null => {\r\n  if (\r\n    selection === null ||\r\n    selection.anchorNode === null ||\r\n    selection.focusNode === null ||\r\n    !rootElement.contains(selection.anchorNode) ||\r\n    !rootElement.contains(selection.focusNode)\r\n  ) {\r\n    return null;\r\n  }\r\n\r\n  const focus = computePosition(rootElement, selection.focusNode, selection.focusOffset);\r\n\r\n  if (selection.anchorNode === selection.focusNode && selection.anchorOffset === selection.focusOffset) {\r\n    return { start: focus, end: focus };\r\n  }\r\n\r\n  const anchor = computePosition(rootElement, selection.anchorNode, selection.anchorOffset);\r\n\r\n  if (\r\n    focus.blockIndex < anchor.blockIndex ||\r\n    (focus.blockIndex === anchor.blockIndex && focus.charIndex < anchor.charIndex)\r\n  ) {\r\n    return { start: focus, end: anchor };\r\n  } else {\r\n    return { start: anchor, end: focus };\r\n  }\r\n};\r\n\r\n/** Render document nodes corresponding to a model phrasing part */\r\nconst renderPart = (part: PhrasingPart, key: string | number | undefined): ReactElement => {\r\n  let element = <Fragment key={key}>{part.text}</Fragment>;\r\n  if (part.strong) {\r\n    element = <strong key={key}>{element}</strong>;\r\n  }\r\n  if (part.em) {\r\n    element = <em key={key}>{element}</em>;\r\n  }\r\n\r\n  return element;\r\n};\r\n\r\n/** Render document nodes corresponding to model phrasing parts */\r\nconst renderParts = (parts: PhrasingPart[]): ReactElement => {\r\n  if (parts.length === 1 && parts[0].text.length === 0) {\r\n    return <br />;\r\n  }\r\n\r\n  const elements: ReactElement[] = [];\r\n\r\n  // group parts with the same href together. Parts with an undefined href are not grouped together.\r\n\r\n  for (let i = 0; i < parts.length; i++) {\r\n    const part = parts[i];\r\n    if (part.href) {\r\n      const subParts: ReactElement[] = [renderPart(part, i)];\r\n      while (i + 1 < parts.length) {\r\n        if (parts[i + 1].href !== part.href) {\r\n          break;\r\n        }\r\n        subParts.push(renderPart(parts[++i], i));\r\n      }\r\n      elements.push(\r\n        <a key={i} href={part.href}>\r\n          {subParts}\r\n        </a>\r\n      );\r\n    } else {\r\n      elements.push(renderPart(part, i));\r\n    }\r\n  }\r\n\r\n  return <>{elements}</>;\r\n};\r\n\r\n/** Render document nodes corresponding to the whole model */\r\nconst render = (state: TextEditorState): ReactElement | null => {\r\n  const elements: ReactElement[] = [];\r\n\r\n  for (let i = 0; i < state.blocks.length; i++) {\r\n    const block = state.blocks[i];\r\n    if (block.type === 'p') {\r\n      elements.push(<p key={i}>{renderParts(block.parts)}</p>);\r\n    } else {\r\n      // ul or ol\r\n      const items: ReactElement[] = [];\r\n\r\n      for (let itemIndex = i; itemIndex < state.blocks.length; itemIndex++) {\r\n        const currentBlock = state.blocks[itemIndex];\r\n        if (currentBlock.type !== block.type) {\r\n          break;\r\n        }\r\n        items.push(<li key={itemIndex}>{renderParts(currentBlock.parts)}</li>);\r\n        i = itemIndex;\r\n      }\r\n      if (block.type === 'ul') {\r\n        elements.push(<ul key={i}>{items}</ul>);\r\n      } else {\r\n        elements.push(<ol key={i}>{items}</ol>);\r\n      }\r\n    }\r\n  }\r\n\r\n  return <>{elements}</>;\r\n};\r\n\r\n/** Find the child node containing the character index. If the appropriate phrasing part is found, an object is returned. Otherwise the remaining index count is returned. */\r\nconst getPhrasingPartAtIndex = (parent: Node, charIndex: number): { node: Node; charIndex: number } | number => {\r\n  var currentIndex = charIndex;\r\n  for (var i = 0; i < parent.childNodes.length; i++) {\r\n    var node = parent.childNodes[i];\r\n    if (node.nodeType === Node.TEXT_NODE) {\r\n      if (currentIndex <= node.textContent!.length) {\r\n        return {\r\n          node,\r\n          charIndex: currentIndex,\r\n        };\r\n      }\r\n      currentIndex -= node.textContent!.length;\r\n    } else {\r\n      var subPhrasingPart = getPhrasingPartAtIndex(node, currentIndex);\r\n      if (typeof subPhrasingPart === 'object') {\r\n        return subPhrasingPart;\r\n      }\r\n      currentIndex = subPhrasingPart;\r\n    }\r\n  }\r\n  return currentIndex;\r\n};\r\n\r\n/** Find the node and character index corresponding to a model position */\r\nconst getSelectionNodeAndCharIndex = (\r\n  rootElement: HTMLElement,\r\n  pos: Position\r\n): { node: Node; charIndex: number } | undefined => {\r\n  var blockIndex = pos.blockIndex;\r\n  var block: Node | undefined = undefined;\r\n\r\n  // find the block corresponding to pos.blockIndex\r\n\r\n  for (var nodeIndex = 0; nodeIndex < rootElement.childNodes.length; nodeIndex++) {\r\n    var node = rootElement.childNodes[nodeIndex];\r\n    var nodeName = node.nodeName.toLowerCase();\r\n    if (nodeName === 'p') {\r\n      if (blockIndex === 0) {\r\n        block = node;\r\n        break;\r\n      }\r\n      blockIndex--;\r\n    } else if (nodeName === 'ul' || nodeName === 'ol') {\r\n      for (var itemIndex = 0; itemIndex < node.childNodes.length; itemIndex++) {\r\n        var item = node.childNodes[itemIndex];\r\n        if (blockIndex === 0) {\r\n          block = item;\r\n          break;\r\n        }\r\n        blockIndex--;\r\n      }\r\n      if (block) {\r\n        break;\r\n      }\r\n    } else {\r\n      throw new Error('Unexpected block type: ' + node.nodeName);\r\n    }\r\n  }\r\n\r\n  if (!block) {\r\n    return undefined;\r\n  }\r\n\r\n  // find the node and index corresponding to pos.charIndex\r\n\r\n  if (pos.charIndex === 0) {\r\n    return { node: block, charIndex: 0 };\r\n  }\r\n\r\n  var phrasingPart = getPhrasingPartAtIndex(block, pos.charIndex);\r\n  if (typeof phrasingPart === 'object') {\r\n    return phrasingPart;\r\n  }\r\n\r\n  return undefined;\r\n};\r\n\r\n/** Set the document selection so it matches the state selection. */\r\nconst ensureStateSelection = (rootElement: HTMLElement, state: TextEditorState) => {\r\n  let selection = window.getSelection();\r\n\r\n  if (!selection) {\r\n    return;\r\n  }\r\n\r\n  if (state.selection === null) {\r\n    selection.removeAllRanges();\r\n    return;\r\n  }\r\n\r\n  while (selection.rangeCount > 1) {\r\n    selection.removeRange(selection.getRangeAt(1));\r\n  }\r\n\r\n  var editorCompatibleSelection = computeSelection(rootElement, selection);\r\n\r\n  if (\r\n    editorCompatibleSelection == null ||\r\n    editorCompatibleSelection.start.blockIndex !== state.selection.start.blockIndex ||\r\n    editorCompatibleSelection.start.charIndex !== state.selection.start.charIndex ||\r\n    editorCompatibleSelection.end.blockIndex !== state.selection.end.blockIndex ||\r\n    editorCompatibleSelection.end.charIndex !== state.selection.end.charIndex\r\n  ) {\r\n    selection.removeAllRanges();\r\n    var startNodeAndCharIndex = getSelectionNodeAndCharIndex(rootElement, state.selection.start);\r\n    var endNodeAndCharIndex = getSelectionNodeAndCharIndex(rootElement, state.selection.end);\r\n    if (startNodeAndCharIndex && endNodeAndCharIndex) {\r\n      let range = document.createRange();\r\n      range.setStart(startNodeAndCharIndex.node, startNodeAndCharIndex.charIndex);\r\n      range.setEnd(endNodeAndCharIndex.node, endNodeAndCharIndex.charIndex);\r\n      selection.addRange(range);\r\n    }\r\n  }\r\n};\r\n\r\n/** Pure debugging function to show information about the current selection. */\r\nconst getBrowserSelection = (): string => {\r\n  let selection = window.getSelection();\r\n\r\n  if (selection === null) {\r\n    return 'null';\r\n  }\r\n\r\n  if (selection === undefined) {\r\n    return 'undefined';\r\n  }\r\n\r\n  var result = `\\n  rangeCount: ${selection.rangeCount}`;\r\n\r\n  if (selection.anchorNode == null) {\r\n    result += '\\n  anchorNode: null';\r\n  } else {\r\n    result += `\\n  anchorNode: ${selection.anchorNode.nodeName}/${selection.anchorOffset}`;\r\n  }\r\n\r\n  if (selection.focusNode == null) {\r\n    result += '\\n  focusNode: null';\r\n  } else {\r\n    result += `\\n  focusNode: ${selection.focusNode.nodeName}/${selection.focusOffset}`;\r\n  }\r\n\r\n  for (var i = 0; i < selection.rangeCount; i++) {\r\n    var range = selection.getRangeAt(i);\r\n    result += `\\n  range ${i}:\\n    startContainer: ${range.startContainer.nodeName}/${range.startOffset}\\n    endContainer: ${range.endContainer.nodeName}/${range.endOffset}`;\r\n  }\r\n\r\n  return result;\r\n};\r\n\r\n/**\r\n * The text editor has the following components:\r\n * - An editor section (contentEditable) where the user edits the text.\r\n *   Paste operations are intercepted and redirected to the clipboardDiv.\r\n *   All changes are synchronized to a state.\r\n * - A state which contains the structure of the editor as a POJO.\r\n *   That state gets persisted together with the data.\r\n * - A hidden clipboardDiv where the pasted contents are pasted. It is then\r\n *   analyzed and its extracted content goes to the state, then to the text editor.\r\n */\r\nexport const TextEditor: React.FC = () => {\r\n  const [state, setState] = React.useState(() => TestTextEditorState);\r\n\r\n  var sectionRef = React.useRef<HTMLElement>(null);\r\n\r\n  const beforeInputHandler = React.useCallback((event) => {\r\n    const inputEvent = event as InputEvent;\r\n    console.log('event', inputEvent.inputType, inputEvent.data, inputEvent);\r\n    if (inputEvent.inputType === 'insertText') {\r\n      setState((s) => textTyped(s, inputEvent.data || ''));\r\n    }\r\n    if (inputEvent.inputType === 'deleteContentBackward') {\r\n      setState(deleteContentBackward);\r\n    }\r\n    if (inputEvent.inputType === 'deleteContentForward') {\r\n      setState(deleteContentForward);\r\n    }\r\n    if (inputEvent.inputType === 'insertParagraph') {\r\n      setState(insertParagraph);\r\n    }\r\n    event.preventDefault();\r\n  }, []);\r\n\r\n  const selectionChangeEventHandler = React.useCallback(() => {\r\n    const selection = document.getSelection();\r\n    setState((s) => ({ ...s, selection: computeSelection(sectionRef.current!, selection) }));\r\n  }, []);\r\n\r\n  React.useLayoutEffect(() => {\r\n    var div = sectionRef.current!;\r\n    div.addEventListener('beforeinput', beforeInputHandler);\r\n    document.addEventListener('selectionchange', selectionChangeEventHandler);\r\n\r\n    return () => {\r\n      div.removeEventListener('beforeinput', beforeInputHandler);\r\n      document.removeEventListener('selectionchange', selectionChangeEventHandler);\r\n    };\r\n  }, [beforeInputHandler, selectionChangeEventHandler]);\r\n\r\n  React.useLayoutEffect(() => {\r\n    // set the selection defined in the state.\r\n    ensureStateSelection(sectionRef.current!, state);\r\n  }, [state]);\r\n\r\n  return (\r\n    <div className={styles.wrapper}>\r\n      <div>\r\n        <section ref={sectionRef} contentEditable className={styles.textEditor} suppressContentEditableWarning={true}>\r\n          {render(state)}\r\n        </section>\r\n        <pre>State selection: {state.selection === null ? '-' : `${JSON.stringify(state.selection, null, '  ')}`}</pre>\r\n        <pre>Browser selection: {getBrowserSelection()}</pre>\r\n      </div>\r\n      <div>\r\n        <pre>Blocks: {state.blocks === null ? '-' : `${JSON.stringify(state.blocks, null, '  ')}`}</pre>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","import React from 'react';\r\nimport styles from './TextEditor.module.scss';\r\n\r\nexport const AnalysisEditor: React.FC = () => {\r\n  const [events, setEvents] = React.useState('');\r\n\r\n  var sectionRef = React.useRef<HTMLElement>(null);\r\n\r\n  const beforeInputHandler = React.useCallback((event) => {\r\n    const inputEvent = event as InputEvent;\r\n    console.log('event', inputEvent.inputType, inputEvent.data, inputEvent);\r\n    setEvents(\r\n      (events) =>\r\n        `beforeInput-${inputEvent.inputType} type:${inputEvent.type} ${\r\n          inputEvent.data\r\n        } cancelable:${inputEvent.cancelable.toString()} isComposing:${inputEvent.isComposing}\\n${events}`\r\n    );\r\n    // if (inputEvent.inputType === 'insertText') {\r\n    //   setState((s) => textTyped(s, inputEvent.data || ''));\r\n    // }\r\n    // if (inputEvent.inputType === 'deleteContentBackward') {\r\n    //   setState(deleteContentBackward);\r\n    // }\r\n    // if (inputEvent.inputType === 'deleteContentForward') {\r\n    //   setState(deleteContentForward);\r\n    // }\r\n    // if (inputEvent.inputType === 'insertParagraph') {\r\n    //   setState(insertParagraph);\r\n    // }\r\n    // event.preventDefault();\r\n  }, []);\r\n\r\n  const selectionChangeEventHandler = React.useCallback(() => {\r\n    const selection = document.getSelection();\r\n    let desc: string;\r\n    if (!selection) {\r\n      desc = 'no selection';\r\n    } else {\r\n      if (!selection.focusNode) {\r\n        desc = 'no focus node';\r\n      } else {\r\n        desc = `focus ${selection.focusNode.nodeType}:${selection.focusOffset}`;\r\n      }\r\n\r\n      if (selection.anchorNode) {\r\n        desc += `, anchor ${selection.anchorNode.nodeType}:${selection.anchorOffset}`;\r\n      }\r\n    }\r\n    setEvents((events) => `selectionchange ${desc}\\n${events}`);\r\n    console.log(`selectionchange ${desc}\\n`, selection);\r\n  }, []);\r\n\r\n  const inputLogger = React.useCallback((event) => {\r\n    const inputEvent = event as InputEvent;\r\n    setEvents(\r\n      (events) =>\r\n        `input-${inputEvent.inputType} type:${inputEvent.type} ${\r\n          inputEvent.data\r\n        } cancelable:${inputEvent.cancelable.toString()} isComposing:${inputEvent.isComposing}\\n${events}`\r\n    );\r\n  }, []);\r\n\r\n  const compositionEventLogger = React.useCallback((ev) => {\r\n    const event = ev as CompositionEvent;\r\n    setEvents(\r\n      (events) => `composition-${event.type} ${event.data} cancelable:${event.cancelable.toString()}\\n${events}`\r\n    );\r\n  }, []);\r\n\r\n  React.useLayoutEffect(() => {\r\n    var div = sectionRef.current!;\r\n    div.addEventListener('beforeinput', beforeInputHandler);\r\n    document.addEventListener('selectionchange', selectionChangeEventHandler);\r\n    div.addEventListener('input', inputLogger);\r\n    div.addEventListener('compositionstart', compositionEventLogger);\r\n    div.addEventListener('compositionupdate', compositionEventLogger);\r\n    div.addEventListener('compositionend', compositionEventLogger);\r\n\r\n    const callback: MutationCallback = (mutationsList) => {\r\n      for (const mutation of mutationsList) {\r\n        if (mutation.type === 'attributes') {\r\n          console.log('mutationObserver-attributes: the ' + mutation.attributeName + ' attribute was modified.');\r\n        } else {\r\n          console.log(`mutationObserver-${mutation.type}`);\r\n        }\r\n      }\r\n    };\r\n    const observer = new MutationObserver(callback);\r\n    observer.observe(div, { attributes: true, childList: true, subtree: true });\r\n\r\n    return () => {\r\n      div.removeEventListener('beforeinput', beforeInputHandler);\r\n      document.removeEventListener('selectionchange', selectionChangeEventHandler);\r\n      div.removeEventListener('input', inputLogger);\r\n      div.removeEventListener('compositionstart', compositionEventLogger);\r\n      div.removeEventListener('compositionupdate', compositionEventLogger);\r\n      div.removeEventListener('compositionend', compositionEventLogger);\r\n      observer.disconnect();\r\n    };\r\n  }, [beforeInputHandler, selectionChangeEventHandler, inputLogger, compositionEventLogger]);\r\n\r\n  return (\r\n    <div>\r\n      <div>\r\n        <section ref={sectionRef} contentEditable className={styles.textEditor} suppressContentEditableWarning={true}>\r\n          <p>\r\n            Hello, this is some text with a\r\n            <span contentEditable={false} style={{ backgroundColor: 'yellow' }}>\r\n              page reference\r\n            </span>\r\n            , <span>which</span>\r\n            <span> is</span> not editable.\r\n          </p>\r\n        </section>\r\n      </div>\r\n      <div>\r\n        <pre>{sectionRef.current ? sectionRef.current.outerHTML : ''}</pre>\r\n      </div>\r\n      <div>\r\n        <pre>{events}</pre>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","import React from 'react';\nimport styles from './App.module.scss';\nimport { Switch, Route, useLocation, Redirect } from 'react-router-dom';\nimport { ErrorBoundary } from '../ErrorBoundary/ErrorBoundary';\nimport { TaskList } from '../Tasks/TaskList';\nimport { PageLayout } from './PageLayout';\nimport { IconDesigner } from '../IconDesigner/IconDesigner';\nimport { TextEditor } from '../TextEditor/TextEditor';\nimport { AnalysisEditor } from '../TextEditor/AnalysisEditor';\n\nfunction NoMatch() {\n  let location = useLocation();\n\n  return <>Invalid path: « {location.pathname} »</>;\n}\n\nexport const AppComponent = () => {\n  return (\n    <div className={styles.app}>\n      <ErrorBoundary>\n        <Switch>\n          <Route path=\"/\" exact>\n            <Redirect to=\"/tasks\" />\n          </Route>\n          <Route path=\"/editor-analysis\" exact>\n            <PageLayout>\n              <AnalysisEditor />\n            </PageLayout>\n          </Route>\n          <Route path=\"/editor-test\" exact>\n            <PageLayout>\n              <TextEditor />\n            </PageLayout>\n          </Route>\n          <Route path=\"/home\" exact>\n            <PageLayout>\n              Home page\n              <IconDesigner />\n            </PageLayout>\n          </Route>\n          <Route path=\"/tasks\" exact>\n            <TaskList />\n          </Route>\n          <Route path=\"*\">\n            <NoMatch />\n          </Route>\n        </Switch>\n      </ErrorBoundary>\n    </div>\n  );\n};\n","import React from 'react';\nimport styles from './LoadStatus.module.scss';\nimport logo from '../../Assets/boussole.svg';\n\nexport type LoadStatusProps = {\n  done: number;\n  total: number;\n  message: string;\n};\n\nexport const LoadStatus: React.FC<LoadStatusProps> = ({ done, total, message }) => {\n  const rects: JSX.Element[] = [];\n\n  for (var i = 0; i < total; i++) {\n    rects.push(\n      <rect\n        key={i}\n        x={i * 120}\n        y=\"2.5\"\n        width=\"95\"\n        height=\"95\"\n        rx=\"25\"\n        ry=\"25\"\n        style={{\n          fill: i < done ? 'rgb(125, 160, 191)' : 'rgb(255, 255, 255)',\n          strokeWidth: 5,\n          stroke: 'rgb(67, 106, 140)',\n        }}\n      />\n    );\n  }\n\n  return (\n    <div className={styles.loadStatus}>\n      <img src={logo} alt=\"logo\" />\n      <svg className={styles.loadBar} viewBox={`0 0 ${total * 120 - 20} 100`}>\n        {rects}\n      </svg>\n      {message}\n    </div>\n  );\n};\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL((process as { env: { [key: string]: string } }).env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker === null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (response.status === 404 || (contentType !== null && contentType.indexOf('javascript') === -1)) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log('No internet connection found. App is running in offline mode.');\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then((registration) => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport { App } from './Components/App/App';\nimport * as serviceWorker from './serviceWorker';\n\n// window.addEventListener('beforeunload', (event) => {\n//   // Cancel the event as stated by the standard.\n//   event.preventDefault();\n//   // Chrome requires returnValue to be set.\n//   event.returnValue = '';\n// });\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","import React from 'react';\nimport { HashRouter as Router } from 'react-router-dom';\nimport { AppComponent } from './AppComponent';\nimport { AuthManagerProvider } from '../../Services/Auth/AuthManagerProvider';\nimport { BoussoleDataStoreProvider } from '../../Services/BoussoleDataStore/BoussoleDataStoreProvider';\nimport { BoussoleDataStateProvider } from '../../Services/BoussoleDataState/BoussoleDataStateProvider';\nimport { BoussoleDataProvider } from '../../Services/BoussoleData/BoussoleDataProvider';\nimport { BoussoleDataServiceProvider } from '../../Services/BoussoleDataService/BoussoleDataServiceProvider';\nimport { LoadStatus } from '../LoadStatus/LoadStatus';\n\nexport const App: React.FC = () => {\n  return (\n    <AuthManagerProvider\n      getNotAuthenticatedComponents={() => <LoadStatus done={0} total={2} message=\"Authentification en cours...\" />}\n      getAuthenticatedComponents={() => (\n        <BoussoleDataStoreProvider>\n          <BoussoleDataStateProvider\n            getNotReadyComponents={() => <LoadStatus done={1} total={2} message=\"Chargement des données...\" />}\n            getReadyComponents={() => (\n              <BoussoleDataProvider>\n                <BoussoleDataServiceProvider>\n                  <Router>\n                    <AppComponent />\n                  </Router>\n                </BoussoleDataServiceProvider>\n              </BoussoleDataProvider>\n            )}\n          />\n        </BoussoleDataStoreProvider>\n      )}\n    />\n  );\n};\n"],"sourceRoot":""}