(this.webpackJsonpboussole=this.webpackJsonpboussole||[]).push([[0],{163:function(e,t,n){},173:function(e,t,n){e.exports=n(336)},178:function(e,t,n){},179:function(e,t,n){},221:function(e,t){},223:function(e,t){},257:function(e,t){},258:function(e,t){},331:function(e,t,n){},336:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),s=n(165),r=n.n(s),o=(n(178),n(179),n(28)),c=n(61),u=n(33),l=n(6),h=n.n(l),d=n(40),f=n(60),m=n(166),p=["https://www.googleapis.com/auth/userinfo.profile","https://www.googleapis.com/auth/drive"];window.boussoleAuthManager||(window.boussoleAuthManager=new function e(){var t=this;Object(f.a)(this,e),this.oAuth2Client=new m.OAuth2Client({clientId:"186913784324-548k2j5jsqlht13qhu2miegr42fu0v56.apps.googleusercontent.com",redirectUri:"".concat(window.location.origin)}),this.state=void 0,this.listeners=[],this.setState=function(e){t.state=e,t.listeners.forEach((function(t){return t(e)}))},this.subscribe=function(e){t.listeners.push(e)},this.unsubscribe=function(e){var n=t.listeners.indexOf(e);n>-1&&t.listeners.splice(n,1)},this.getState=function(){return t.state},this.getOAuth2Client=function(){return t.oAuth2Client},this.authenticate=function(){console.debug("Auth: RedirectingToGoogle"),t.state={status:"AuthenticationNeeded"},Object(d.a)(h.a.mark((function e(){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.oAuth2Client.generateAuthUrl({scope:p,login_hint:"lucmoco@gmail.com",state:window.location.pathname+window.location.search+window.location.hash,response_type:"token"}),window.location.href=n;case 2:case"end":return e.stop()}}),e)})))()},this.oAuth2Client.transporter.configure();var n=new URLSearchParams(window.location.hash.substr(1)),a=n.get("access_token");if(null!=a){var i=n.get("state");if(!i)throw new Error("missing originalPage field.");var s=n.get("expires_in");if(!s)throw new Error("missing expires_in field.");var r=new Date;r.setSeconds(r.getSeconds()+parseInt(s)),console.debug("Auth: TokenReceived"),this.state={status:"TokenReceived"},this.oAuth2Client.setCredentials({access_token:a}),localStorage.setItem("access_token","".concat(a,"|").concat(r.toISOString())),window.history.replaceState(null,"",i),this.setState({status:"Authenticated",expiration:r})}else{var o=localStorage.getItem("access_token"),c=null;if(o){var u=o.split("|");a=u[0],(c=new Date(u[1])).getTime()<(new Date).getTime()+6e5&&(c=null)}null!=c?(this.oAuth2Client.setCredentials({access_token:a}),this.state={status:"Authenticated",expiration:c}):(this.state={status:"AuthenticationNeeded"},this.authenticate())}});var w=window.boussoleAuthManager;function v(){w.authenticate()}function g(){var e=Object(a.useState)(w.getState()),t=Object(u.a)(e,2),n=t[0],s=t[1];return i.a.useEffect((function(){var e;e=s,w.subscribe(e)}),[]),n}var k=n(167),E=n(171),b=n(168),S=n(172),A=function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(E.a)(this,Object(b.a)(t).call(this,e))).state={isError:!1,error:null},n}return Object(S.a)(t,e),Object(k.a)(t,[{key:"componentDidCatch",value:function(e,t){this.setState({isError:!0,error:t})}},{key:"render",value:function(){return this.state.isError?a.createElement("div",null,this.state.error.componentStack):this.props.children}}]),t}(a.Component);n(331);function O(e){var t=Math.round((e.getTime()-(new Date).getTime())/1e3);return t>100?"".concat(Math.round(t/60)," minutes"):"".concat(Math.round(t)," seconds")}function C(e){var t=e.authState,n="Authenticated"==t.status?t.expiration:null,a=i.a.useState(null===n?null:O(n)),s=Object(u.a)(a,2),r=s[0],o=s[1];return i.a.useEffect((function(){if(null!==n){var e=setInterval((function(){o(O(n))}),1e3);return function(){return clearInterval(e)}}}),[n]),null===n?i.a.createElement("div",null,"Not authenticated."):i.a.createElement("div",{className:"authStatus"},t.status,", expiration: ",r,i.a.createElement("span",{className:"authRenewButton",onClick:v},"Renew"))}n(163);function x(){return j.apply(this,arguments)}function j(){return(j=Object(d.a)(h.a.mark((function e(){var t,n,a,i,s,r,o,c;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=w.getOAuth2Client(),null!=(n=window.localStorage.NotesFileId)){e.next=13;break}return a=new URLSearchParams({q:"'root' in parents and mimeType = 'application/vnd.google-apps.folder' and name = 'notes-perso-boussole'",fields:"files/id"}),e.next=6,t.request({url:"https://www.googleapis.com/drive/v3/files?".concat(a)});case 6:return i=e.sent,s=i.data.files[0].id,r=new URLSearchParams({q:"'".concat(s,"' in parents and name = 'notes.json'"),fields:"files/id"}),e.next=11,t.request({url:"https://www.googleapis.com/drive/v3/files?".concat(r)});case 11:o=e.sent,window.localStorage.NotesFileId=n=o.data.files[0].id;case 13:return e.next=15,t.request({url:"https://www.googleapis.com/drive/v3/files/".concat(n,"?alt=media")});case 15:return c=e.sent,e.abrupt("return",c.data);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e){return i.a.createElement("div",{onClick:e.onClick,className:"task"},e.task.title)}function N(e){return i.a.createElement("div",{className:"taskForm"},i.a.createElement("div",null,e.task.title),i.a.createElement("div",null,i.a.createElement("div",{onClick:function(){return e.onClose()},className:"closeButton"},"close")))}function T(){var e=i.a.useState({tasks:[]}),t=Object(u.a)(e,2),n=t[0],a=t[1],s=i.a.useState({isOpen:!1}),r=Object(u.a)(s,2),o=r[0],c=r[1];return i.a.useEffect((function(){Object(d.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=a,e.next=4,x();case 4:e.t1=e.sent,(0,e.t0)(e.t1),e.next=11;break;case 8:e.prev=8,e.t2=e.catch(0),a(e.t2.toString());case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))()}),[]),i.a.createElement("div",{className:"tasks"},n.tasks.map((function(e){return i.a.createElement(I,{key:e.id,task:e,onClick:function(){return c({isOpen:!0,taskId:e.id})}})})),o.isOpen&&i.a.createElement(N,{task:o.taskId?n.tasks.find((function(e){return e.id===o.taskId})):void 0,onClose:function(){return c({isOpen:!1})}}))}function y(){var e=Object(o.f)();return i.a.createElement(i.a.Fragment,null,"Invalid path: \xab ",e.pathname," \xbb")}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(i.a.createElement((function(){var e=g();return"Error"===e.status?i.a.createElement("div",null,'Authentication failed: "',e.errorMessage,'"'):"AuthenticationNeeded"===e.status?i.a.createElement("div",null,"Auth required. AuthenticationNeeded..."):"TokenReceived"===e.status?i.a.createElement("div",null,"TokenReceived..."):i.a.createElement(c.a,null,i.a.createElement("div",{className:"App"},i.a.createElement("header",null,i.a.createElement(c.b,{to:"/"},"Home"),i.a.createElement(c.b,{to:"/tasks"},"Tasks"),i.a.createElement(C,{authState:e})),i.a.createElement("section",null,i.a.createElement(A,null,i.a.createElement(o.c,null,i.a.createElement(o.a,{path:"/",exact:!0},"Home"),i.a.createElement(o.a,{path:"/tasks",exact:!0},i.a.createElement(T,null)),i.a.createElement(o.a,{path:"*"},i.a.createElement(y,null)))))))}),null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},85:function(e,t){}},[[173,1,2]]]);
//# sourceMappingURL=main.a408f73d.chunk.js.map