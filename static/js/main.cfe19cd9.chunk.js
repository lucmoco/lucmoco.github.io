(this.webpackJsonpboussole=this.webpackJsonpboussole||[]).push([[0],{171:function(e,t,n){},180:function(e,t,n){e.exports=n(346)},185:function(e,t,n){},231:function(e,t){},233:function(e,t){},267:function(e,t){},268:function(e,t){},341:function(e,t,n){},342:function(e,t,n){},343:function(e,t,n){},344:function(e,t,n){},346:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(65),c=n.n(o),i=(n(185),n(56)),s=n(44),u=n(172),l=n(67),d="0123456789abcdef";function f(e){for(var t="",n=0;n<e;n++)t+=d.charAt(Math.floor(Math.random()*d.length));return t}var h=n(30);function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(n,!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function m(e,t){var n="".concat(f(8),"-").concat(f(4),"-").concat(f(4),"-").concat(f(4),"-").concat(f(12));return e[n]=v({},t,{id:n}),v({},e)}var g=function(){return Object(h.c)((function(e){return e.tasks}))};var w=n(5),b=n.n(w),k=n(29),E=n(68),O=n(174),y=["https://www.googleapis.com/auth/userinfo.profile","https://www.googleapis.com/auth/drive"];window.boussoleAuthManager||(window.boussoleAuthManager=new function e(){var t=this;Object(E.a)(this,e),this.oAuth2Client=new O.OAuth2Client({clientId:"186913784324-548k2j5jsqlht13qhu2miegr42fu0v56.apps.googleusercontent.com",redirectUri:"".concat(window.location.origin)}),this.state=void 0,this.listeners=[],this.setState=function(e){t.state=e,t.listeners.forEach((function(t){return t(e)}))},this.subscribe=function(e){t.listeners.push(e)},this.unsubscribe=function(e){var n=t.listeners.indexOf(e);n>-1&&t.listeners.splice(n,1)},this.getState=function(){return t.state},this.getOAuth2Client=function(){return t.oAuth2Client},this.authenticate=function(){console.debug("Auth: RedirectingToGoogle"),t.state={status:"AuthenticationNeeded"},Object(k.a)(b.a.mark((function e(){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.oAuth2Client.generateAuthUrl({scope:y,login_hint:"lucmoco@gmail.com",state:window.location.pathname+window.location.search+window.location.hash,response_type:"token"}),window.location.href=n;case 2:case"end":return e.stop()}}),e)})))()},this.oAuth2Client.transporter.configure();var n=new URLSearchParams(window.location.hash.substr(1)),r=n.get("access_token");if(null!=r){var a=n.get("state");if(!a)throw new Error("missing originalPage field.");var o=n.get("expires_in");if(!o)throw new Error("missing expires_in field.");var c=new Date;c.setSeconds(c.getSeconds()+parseInt(o)),console.debug("Auth: TokenReceived"),this.state={status:"TokenReceived"},this.oAuth2Client.setCredentials({access_token:r}),localStorage.setItem("access_token","".concat(r,"|").concat(c.toISOString())),window.history.replaceState(null,"",a),this.setState({status:"Authenticated",expiration:c})}else{var i=localStorage.getItem("access_token"),s=null;if(i){var u=i.split("|");r=u[0],(s=new Date(u[1])).getTime()<(new Date).getTime()+6e5&&(s=null)}null!=s?(this.oAuth2Client.setCredentials({access_token:r}),this.state={status:"Authenticated",expiration:s}):(this.state={status:"AuthenticationNeeded"},this.authenticate())}});var j=window.boussoleAuthManager;function S(){return j.getOAuth2Client()}function C(){j.authenticate()}function x(e){return A.apply(this,arguments)}function A(){return(A=Object(k.a)(b.a.mark((function e(t){var n,r,a,o,c,i;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==(n=window.localStorage.NotesFileId)){e.next=3;break}return e.abrupt("return",n);case 3:return r=new URLSearchParams({q:"'root' in parents and mimeType = 'application/vnd.google-apps.folder' and name = 'notes-perso-boussole'",fields:"files/id"}),e.next=6,t.request({url:"https://www.googleapis.com/drive/v3/files?".concat(r)});case 6:return a=e.sent,o=a.data.files[0].id,c=new URLSearchParams({q:"'".concat(o,"' in parents and name = 'notes.json'"),fields:"files/id"}),e.next=11,t.request({url:"https://www.googleapis.com/drive/v3/files?".concat(c)});case 11:return i=e.sent,window.localStorage.NotesFileId=n=i.data.files[0].id,e.abrupt("return",n);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(){return P.apply(this,arguments)}function P(){return(P=Object(k.a)(b.a.mark((function e(){var t,n,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=S(),e.next=3,x(t);case 3:return n=e.sent,e.next=6,t.request({url:"https://www.googleapis.com/drive/v3/files/".concat(n,"?alt=media")});case 6:return r=e.sent,e.abrupt("return",r.data);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e){return N.apply(this,arguments)}function N(){return(N=Object(k.a)(b.a.mark((function e(t){var n,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=S(),e.next=3,x(n);case 3:return r=e.sent,e.next=6,n.request({url:"https://www.googleapis.com/upload/drive/v3/files/".concat(r),method:"PATCH",data:JSON.stringify(t,null,1)});case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function D(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(n,!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var F=Object(s.c)({tasks:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{asdf:{id:"asdf",title:"asdf"},toto:{id:"toto",title:"toto"}},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"UpdateTask":return function(e,t,n){var r=e[t];if(!r)throw new Error("No task found with id {id}");return e[t]=v({},r,{},n),v({},e)}(e,t.id,t.task);case"CreateTask":return m(e,t.task);default:return e}},dataStorage:function(e){return e||{status:"inactive"}}}),R=function(e,t){return e=function(e,t){if(void 0==e)throw new Error("dataStorageReducer: Unexpected undefined model.");switch(t.type){case"ModelFetching":return D({},e,{dataStorage:D({},e.dataStorage,{status:"fetching",fetchError:void 0})});case"ModelFetched":return D({},t.model,{dataStorage:D({},e.dataStorage,{status:"inactive",fetchError:void 0})});case"ModelFetchError":return D({},e,{dataStorage:D({},e.dataStorage,{status:"inactive",fetchError:t.error})});case"ModelSaving":return D({},e,{dataStorage:D({},e.dataStorage,{status:"saving",saveError:void 0})});case"ModelSaved":return D({},e,{dataStorage:D({},e.dataStorage,{status:"inactive",saveError:void 0})});case"ModelSaveError":return D({},e,{dataStorage:D({},e.dataStorage,{status:"inactive",saveError:t.error})});default:return e}}(e=F(e,t),t)},q=function(){return Object(s.d)(R,Object(s.a)(u.a))},_=(n(341),n(34)),U=n(33);function B(){var e=Object(r.useState)(j.getState()),t=Object(U.a)(e,2),n=t[0],o=t[1];return a.a.useEffect((function(){var e;e=o,j.subscribe(e)}),[]),n}var H=n(175),J=n(178),L=n(176),W=n(179),G=function(e){function t(e){var n;return Object(E.a)(this,t),(n=Object(J.a)(this,Object(L.a)(t).call(this,e))).state={isError:!1,error:null},n}return Object(W.a)(t,e),Object(H.a)(t,[{key:"componentDidCatch",value:function(e,t){this.setState({isError:!0,error:t})}},{key:"render",value:function(){return this.state.isError?r.createElement("div",null,this.state.error.componentStack):this.props.children}}]),t}(r.Component);n(342);function $(e){var t=Math.round((e.getTime()-(new Date).getTime())/1e3);return t>100?"".concat(Math.round(t/60)," minutes"):"".concat(Math.round(t)," seconds")}function z(e){var t=e.authState,n="Authenticated"==t.status?t.expiration:null,r=a.a.useState(null===n?null:$(n)),o=Object(U.a)(r,2),c=o[0],i=o[1];return a.a.useEffect((function(){if(null!==n){var e=setInterval((function(){i($(n))}),1e3);return function(){return clearInterval(e)}}}),[n]),null===n?a.a.createElement("div",null,"Not authenticated."):a.a.createElement("div",{className:"authStatus"},t.status,", expiration: ",c,a.a.createElement("span",{className:"authRenewButton",onClick:C},"Renew"))}n(171);function K(e){return a.a.createElement("div",{onClick:e.onClick,className:"task"},e.task.title)}n(343);var Q=function(e){var t=e.onClick,n=e.children;return a.a.createElement("div",{className:"button",onClick:t},n)};function V(e){var t=Object(r.useMemo)((function(){return e.task?e.task.id:void 0}),[e.task]),n=Object(r.useState)(e.task||{title:""}),o=Object(U.a)(n,2),c=o[0],i=o[1],s=function(){var e=Object(h.b)();return{createTask:function(t){return e({type:"CreateTask",task:t})},updateTask:function(t,n){return e({type:"UpdateTask",id:t,task:n})}}}(),u=s.createTask,l=s.updateTask;return a.a.createElement("div",{className:"taskForm"},"Titre",a.a.createElement("br",null),a.a.createElement("input",{type:"text",value:c.title,onChange:function(e){return i({title:e.target.value})}}),a.a.createElement("div",null,a.a.createElement(Q,{onClick:function(){t?l(t,c):u(c),e.onClose()}},"Enregistrer"),a.a.createElement(Q,{onClick:e.onClose},"Fermer")))}function X(){var e=g(),t=a.a.useState({isOpen:!1}),n=Object(U.a)(t,2),r=n[0],o=n[1];return a.a.createElement("div",{className:"tasks"},Object.keys(e).map((function(t){return a.a.createElement(K,{key:t,task:e[t],onClick:function(){return o({isOpen:!0,taskId:t})}})})),r.isOpen&&a.a.createElement(V,{task:r.taskId?e[r.taskId]:void 0,onClose:function(){return o({isOpen:!1})}}),a.a.createElement(Q,{onClick:function(){return o({isOpen:!0,taskId:void 0})}},"+"))}n(344);var Y=function(e){var t=e.children;return a.a.createElement("div",{className:"overlay"},t)};function Z(){var e=Object(_.f)();return a.a.createElement(a.a.Fragment,null,"Invalid path: \xab ",e.pathname," \xbb")}var ee=function(){var e=B(),t=Object(h.c)((function(e){return e.dataStorage})),n=function(){var e=Object(h.b)();return function(){return e(function(){var e=Object(k.a)(b.a.mark((function e(t,n){var r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("inactive"===n().dataStorage.status){e.next=3;break}throw Error("An action is already ongoing.");case 3:return t({type:"ModelFetching"}),e.prev=4,e.next=7,M();case 7:r=e.sent,t({type:"ModelFetched",model:r}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),t({type:"ModelFetchError",error:e.t0});case 14:case"end":return e.stop()}}),e,null,[[4,11]])})));return function(t,n){return e.apply(this,arguments)}}())}}(),r=function(){var e=Object(h.b)();return function(){return e(function(){var e=Object(k.a)(b.a.mark((function e(t,n){var r,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("inactive"===(r=n()).dataStorage.status){e.next=3;break}throw Error("An action is already ongoing.");case 3:return t({type:"ModelSaving"}),e.prev=4,e.next=7,T(r);case 7:a=e.sent,t({type:"ModelSaved",model:a}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),t({type:"ModelSaveError",error:e.t0});case 14:case"end":return e.stop()}}),e,null,[[4,11]])})));return function(t,n){return e.apply(this,arguments)}}())}}();return"Error"===e.status?a.a.createElement("div",null,'Authentication failed: "',e.errorMessage,'"'):"AuthenticationNeeded"===e.status?a.a.createElement("div",null,"Auth required. AuthenticationNeeded..."):"TokenReceived"===e.status?a.a.createElement("div",null,"TokenReceived..."):a.a.createElement("div",{className:"App"},a.a.createElement("header",null,a.a.createElement(i.b,{to:"/"},"Home"),a.a.createElement(i.b,{to:"/tasks"},"T\xe2ches"),a.a.createElement(z,{authState:e}),a.a.createElement(Q,{onClick:n},"Charger"),a.a.createElement(Q,{onClick:r},"Enregistrer")),a.a.createElement("section",null,a.a.createElement(G,null,a.a.createElement(_.c,null,a.a.createElement(_.a,{path:"/",exact:!0},"Home page"),a.a.createElement(_.a,{path:"/tasks",exact:!0},a.a.createElement(X,null)),a.a.createElement(_.a,{path:"*"},a.a.createElement(Z,null))))),"fetching"==t.status&&a.a.createElement(Y,null,"Chargement en cours..."),"saving"==t.status&&a.a.createElement(Y,null,"Enregistrement en cours..."))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(a.a.createElement((function(){var e=Object(r.useMemo)(q,[]);return a.a.createElement(h.a,{store:e},a.a.createElement(i.a,null,a.a.createElement(ee,null)))}),null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},92:function(e,t){}},[[180,1,2]]]);
//# sourceMappingURL=main.cfe19cd9.chunk.js.map