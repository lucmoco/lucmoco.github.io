(this.webpackJsonpboussole=this.webpackJsonpboussole||[]).push([[0],{171:function(e,t,n){},180:function(e,t,n){e.exports=n(345)},185:function(e,t,n){},231:function(e,t){},233:function(e,t){},267:function(e,t){},268:function(e,t){},341:function(e,t,n){},342:function(e,t,n){},343:function(e,t,n){},345:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(65),i=n.n(o),c=(n(185),n(56)),s=n(44),u=n(172),l=n(67),d="0123456789abcdef";function f(e){for(var t="",n=0;n<e;n++)t+=d.charAt(Math.floor(Math.random()*d.length));return t}var h=n(31);function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(n,!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function v(e,t){var n="".concat(f(8),"-").concat(f(4),"-").concat(f(4),"-").concat(f(4),"-").concat(f(12));return e[n]=m({},t,{id:n}),m({},e)}var g=n(7),w=n.n(g),b=n(43),k=n(68),O=n(174),E=["https://www.googleapis.com/auth/userinfo.profile","https://www.googleapis.com/auth/drive"];window.boussoleAuthManager||(window.boussoleAuthManager=new function e(){var t=this;Object(k.a)(this,e),this.oAuth2Client=new O.OAuth2Client({clientId:"186913784324-548k2j5jsqlht13qhu2miegr42fu0v56.apps.googleusercontent.com",redirectUri:"".concat(window.location.origin)}),this.state=void 0,this.listeners=[],this.setState=function(e){t.state=e,t.listeners.forEach((function(t){return t(e)}))},this.subscribe=function(e){t.listeners.push(e)},this.unsubscribe=function(e){var n=t.listeners.indexOf(e);n>-1&&t.listeners.splice(n,1)},this.getState=function(){return t.state},this.getOAuth2Client=function(){return t.oAuth2Client},this.authenticate=function(){console.debug("Auth: RedirectingToGoogle"),t.state={status:"AuthenticationNeeded"},Object(b.a)(w.a.mark((function e(){var n;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.oAuth2Client.generateAuthUrl({scope:E,login_hint:"lucmoco@gmail.com",state:window.location.pathname+window.location.search+window.location.hash,response_type:"token"}),window.location.href=n;case 2:case"end":return e.stop()}}),e)})))()},this.oAuth2Client.transporter.configure();var n=new URLSearchParams(window.location.hash.substr(1)),a=n.get("access_token");if(null!=a){var r=n.get("state");if(!r)throw new Error("missing originalPage field.");var o=n.get("expires_in");if(!o)throw new Error("missing expires_in field.");var i=new Date;i.setSeconds(i.getSeconds()+parseInt(o)),console.debug("Auth: TokenReceived"),this.state={status:"TokenReceived"},this.oAuth2Client.setCredentials({access_token:a}),localStorage.setItem("access_token","".concat(a,"|").concat(i.toISOString())),window.history.replaceState(null,"",r),this.setState({status:"Authenticated",expiration:i})}else{var c=localStorage.getItem("access_token"),s=null;if(c){var u=c.split("|");a=u[0],(s=new Date(u[1])).getTime()<(new Date).getTime()+6e5&&(s=null)}null!=s?(this.oAuth2Client.setCredentials({access_token:a}),this.state={status:"Authenticated",expiration:s}):(this.state={status:"AuthenticationNeeded"},this.authenticate())}});var j=window.boussoleAuthManager;function y(){j.authenticate()}function S(){return C.apply(this,arguments)}function C(){return(C=Object(b.a)(w.a.mark((function e(){var t,n,a,r,o,i,c,s;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=j.getOAuth2Client(),null!=(n=window.localStorage.NotesFileId)){e.next=13;break}return a=new URLSearchParams({q:"'root' in parents and mimeType = 'application/vnd.google-apps.folder' and name = 'notes-perso-boussole'",fields:"files/id"}),e.next=6,t.request({url:"https://www.googleapis.com/drive/v3/files?".concat(a)});case 6:return r=e.sent,o=r.data.files[0].id,i=new URLSearchParams({q:"'".concat(o,"' in parents and name = 'notes.json'"),fields:"files/id"}),e.next=11,t.request({url:"https://www.googleapis.com/drive/v3/files?".concat(i)});case 11:c=e.sent,window.localStorage.NotesFileId=n=c.data.files[0].id;case 13:return e.next=15,t.request({url:"https://www.googleapis.com/drive/v3/files/".concat(n,"?alt=media")});case 15:return s=e.sent,e.abrupt("return",s.data);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(n,!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var P=Object(s.c)({tasks:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{asdf:{id:"asdf",title:"asdf"},toto:{id:"toto",title:"toto"}},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"UpdateTask":return function(e,t,n){var a=e[t];if(!a)throw new Error("No task found with id {id}");return e[t]=m({},a,{},n),m({},e)}(e,t.id,t.task);case"CreateTask":return v(e,t.task);default:return e}},dataStorage:function(e){return e||{status:"inactive"}}}),T=function(e,t){return e=function(e,t){if(void 0==e)throw new Error("dataStorageReducer: Unexpected undefined model.");switch(t.type){case"ModelFetching":return x({},e,{dataStorage:{status:"fetching"}});case"ModelFetched":return x({},t.model,{dataStorage:{status:"inactive"}});case"ModelFetchError":return x({},e,{dataStorage:{status:"inactive",error:t.error}});default:return e}}(e=P(e,t),t)},M=function(){return Object(s.d)(T,Object(s.a)(u.a))},I=(n(341),n(33)),N=n(32);function D(){var e=Object(a.useState)(j.getState()),t=Object(N.a)(e,2),n=t[0],o=t[1];return r.a.useEffect((function(){var e;e=o,j.subscribe(e)}),[]),n}var F=n(175),R=n(178),_=n(176),q=n(179),U=function(e){function t(e){var n;return Object(k.a)(this,t),(n=Object(R.a)(this,Object(_.a)(t).call(this,e))).state={isError:!1,error:null},n}return Object(q.a)(t,e),Object(F.a)(t,[{key:"componentDidCatch",value:function(e,t){this.setState({isError:!0,error:t})}},{key:"render",value:function(){return this.state.isError?a.createElement("div",null,this.state.error.componentStack):this.props.children}}]),t}(a.Component);n(342);function B(e){var t=Math.round((e.getTime()-(new Date).getTime())/1e3);return t>100?"".concat(Math.round(t/60)," minutes"):"".concat(Math.round(t)," seconds")}function L(e){var t=e.authState,n="Authenticated"==t.status?t.expiration:null,a=r.a.useState(null===n?null:B(n)),o=Object(N.a)(a,2),i=o[0],c=o[1];return r.a.useEffect((function(){if(null!==n){var e=setInterval((function(){c(B(n))}),1e3);return function(){return clearInterval(e)}}}),[n]),null===n?r.a.createElement("div",null,"Not authenticated."):r.a.createElement("div",{className:"authStatus"},t.status,", expiration: ",i,r.a.createElement("span",{className:"authRenewButton",onClick:y},"Renew"))}n(171);function H(e){return r.a.createElement("div",{onClick:e.onClick,className:"task"},e.task.title)}n(343);var J=function(e){var t=e.onClick,n=e.children;return r.a.createElement("div",{className:"button",onClick:t},n)};function W(e){var t=Object(a.useMemo)((function(){return e.task?e.task.id:void 0}),[e.task]),n=Object(a.useState)(e.task||{title:""}),o=Object(N.a)(n,2),i=o[0],c=o[1],s=function(){var e=Object(h.b)();return{createTask:function(t){return e({type:"CreateTask",task:t})},updateTask:function(t,n){return e({type:"UpdateTask",id:t,task:n})}}}(),u=s.createTask,l=s.updateTask;return r.a.createElement("div",{className:"taskForm"},"Titre",r.a.createElement("br",null),r.a.createElement("input",{type:"text",value:i.title,onChange:function(e){return c({title:e.target.value})}}),r.a.createElement("div",null,r.a.createElement(J,{onClick:function(){t?l(t,i):u(i),e.onClose()}},"Enregistrer"),r.a.createElement(J,{onClick:e.onClose},"Fermer")))}function G(){var e=Object(h.c)((function(e){return e.tasks})),t=r.a.useState({isOpen:!1}),n=Object(N.a)(t,2),a=n[0],o=n[1];return r.a.createElement("div",{className:"tasks"},Object.keys(e).map((function(t){return r.a.createElement(H,{key:t,task:e[t],onClick:function(){return o({isOpen:!0,taskId:t})}})})),a.isOpen&&r.a.createElement(W,{task:a.taskId?e[a.taskId]:void 0,onClose:function(){return o({isOpen:!1})}}),r.a.createElement(J,{onClick:function(){return o({isOpen:!0,taskId:void 0})}},"+"))}function $(){var e=Object(I.f)();return r.a.createElement(r.a.Fragment,null,"Invalid path: \xab ",e.pathname," \xbb")}var z=function(){var e=D(),t=function(){var e=Object(h.b)();return function(){return e(function(){var e=Object(b.a)(w.a.mark((function e(t,n){var a;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("inactive"===n().dataStorage.status){e.next=3;break}throw Error("An action is already ongoing.");case 3:return t({type:"ModelFetching"}),e.prev=4,e.next=7,S();case 7:a=e.sent,t({type:"ModelFetched",model:a}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),t({type:"ModelFetchError",error:e.t0});case 14:case"end":return e.stop()}}),e,null,[[4,11]])})));return function(t,n){return e.apply(this,arguments)}}())}}();return"Error"===e.status?r.a.createElement("div",null,'Authentication failed: "',e.errorMessage,'"'):"AuthenticationNeeded"===e.status?r.a.createElement("div",null,"Auth required. AuthenticationNeeded..."):"TokenReceived"===e.status?r.a.createElement("div",null,"TokenReceived..."):r.a.createElement("div",{className:"App"},r.a.createElement("header",null,r.a.createElement(c.b,{to:"/"},"Home"),r.a.createElement(c.b,{to:"/tasks"},"T\xe2ches"),r.a.createElement(L,{authState:e}),r.a.createElement(J,{onClick:t},"Charger")),r.a.createElement("section",null,r.a.createElement(U,null,r.a.createElement(I.c,null,r.a.createElement(I.a,{path:"/",exact:!0},"Home page"),r.a.createElement(I.a,{path:"/tasks",exact:!0},r.a.createElement(G,null)),r.a.createElement(I.a,{path:"*"},r.a.createElement($,null))))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement((function(){var e=Object(a.useMemo)(M,[]);return r.a.createElement(h.a,{store:e},r.a.createElement(c.a,null,r.a.createElement(z,null)))}),null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},92:function(e,t){}},[[180,1,2]]]);
//# sourceMappingURL=main.c73e8551.chunk.js.map