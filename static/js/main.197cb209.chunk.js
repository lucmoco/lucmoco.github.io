(this.webpackJsonpboussole=this.webpackJsonpboussole||[]).push([[0],{171:function(e,t,n){},180:function(e,t,n){e.exports=n(347)},185:function(e,t,n){},231:function(e,t){},233:function(e,t){},267:function(e,t){},268:function(e,t){},341:function(e,t,n){},342:function(e,t,n){},343:function(e,t,n){},344:function(e,t,n){},345:function(e,t,n){},347:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(65),c=n.n(o),i=(n(185),n(56)),s=n(44),u=n(172),l=n(67),d="0123456789abcdef";function f(e){for(var t="",n=0;n<e;n++)t+=d.charAt(Math.floor(Math.random()*d.length));return t}var h=n(30);function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(n,!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function m(e,t){var n="".concat(f(8),"-").concat(f(4),"-").concat(f(4),"-").concat(f(4),"-").concat(f(12));return e[n]=v({},t,{id:n}),v({},e)}var g=function(){return Object(h.c)((function(e){return e.tasks}))};var w=n(5),b=n.n(w),E=n(29),k=n(68),O=n(174),y=["https://www.googleapis.com/auth/userinfo.profile","https://www.googleapis.com/auth/drive"];window.boussoleAuthManager||(window.boussoleAuthManager=new function e(){var t=this;Object(k.a)(this,e),this.oAuth2Client=new O.OAuth2Client({clientId:"186913784324-548k2j5jsqlht13qhu2miegr42fu0v56.apps.googleusercontent.com",redirectUri:"".concat(window.location.origin)}),this.state=void 0,this.listeners=[],this.setState=function(e){t.state=e,t.listeners.forEach((function(t){return t(e)}))},this.subscribe=function(e){return t.listeners.push(e),function(){t.unsubscribe(e)}},this.unsubscribe=function(e){var n=t.listeners.indexOf(e);n>-1&&t.listeners.splice(n,1)},this.getState=function(){return t.state},this.getOAuth2Client=function(){return t.oAuth2Client},this.authenticate=function(){console.debug("Auth: RedirectingToGoogle"),t.state={status:"AuthenticationNeeded"},Object(E.a)(b.a.mark((function e(){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.oAuth2Client.generateAuthUrl({scope:y,login_hint:"lucmoco@gmail.com",state:window.location.pathname+window.location.search+window.location.hash,response_type:"token"}),window.location.href=n;case 2:case"end":return e.stop()}}),e)})))()},this.oAuth2Client.transporter.configure();var n=new URLSearchParams(window.location.hash.substr(1)),a=n.get("access_token");if(null!=a){var r=n.get("state");if(!r)throw new Error("missing originalPage field.");var o=n.get("expires_in");if(!o)throw new Error("missing expires_in field.");var c=new Date;c.setSeconds(c.getSeconds()+parseInt(o)),console.debug("Auth: TokenReceived"),this.state={status:"TokenReceived"},this.oAuth2Client.setCredentials({access_token:a}),localStorage.setItem("access_token","".concat(a,"|").concat(c.toISOString())),window.history.replaceState(null,"",r),this.setState({status:"Authenticated",expiration:c})}else{var i=localStorage.getItem("access_token"),s=null;if(i){var u=i.split("|");a=u[0],(s=new Date(u[1])).getTime()<(new Date).getTime()+6e5&&(s=null)}null!=s?(this.oAuth2Client.setCredentials({access_token:a}),this.state={status:"Authenticated",expiration:s}):(this.state={status:"AuthenticationNeeded"},this.authenticate())}});var S=window.boussoleAuthManager;function j(e){return C.apply(this,arguments)}function C(){return(C=Object(E.a)(b.a.mark((function e(t){var n,a,r,o,c,i;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==(n=window.localStorage.NotesFileId)){e.next=3;break}return e.abrupt("return",n);case 3:return a=new URLSearchParams({q:"'root' in parents and mimeType = 'application/vnd.google-apps.folder' and name = 'notes-perso-boussole'",fields:"files/id"}),e.next=6,t.request({url:"https://www.googleapis.com/drive/v3/files?".concat(a)});case 6:return r=e.sent,o=r.data.files[0].id,c=new URLSearchParams({q:"'".concat(o,"' in parents and name = 'notes.json'"),fields:"files/id"}),e.next=11,t.request({url:"https://www.googleapis.com/drive/v3/files?".concat(c)});case 11:return i=e.sent,window.localStorage.NotesFileId=n=i.data.files[0].id,e.abrupt("return",n);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(){if("Authenticated"!=S.getState().status)throw new Error("Not authenticated.")}function A(){return(A=Object(E.a)(b.a.mark((function e(){var t,n,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x(),t=S.getOAuth2Client(),e.next=4,j(t);case 4:return n=e.sent,e.next=7,t.request({url:"https://www.googleapis.com/drive/v3/files/".concat(n,"?alt=media")});case 7:return a=e.sent,e.abrupt("return",a.data);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(){return(M=Object(E.a)(b.a.mark((function e(t){var n,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x(),n=S.getOAuth2Client(),e.next=4,j(n);case 4:return a=e.sent,e.next=7,n.request({url:"https://www.googleapis.com/upload/drive/v3/files/".concat(a),method:"PATCH",data:JSON.stringify(t,null,1)});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var P={getData:function(){return A.apply(this,arguments)},saveData:function(e){return M.apply(this,arguments)}};function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(n,!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var D=function(e){e(function(){var e=Object(E.a)(b.a.mark((function e(t,n){var a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("inactive"===n().dataStorage.status){e.next=3;break}throw Error("An action is already ongoing.");case 3:return t({type:"ModelFetching"}),e.prev=4,e.next=7,P.getData();case 7:a=e.sent,t({type:"ModelFetched",model:a}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),t({type:"ModelFetchError",error:e.t0});case 14:case"end":return e.stop()}}),e,null,[[4,11]])})));return function(t,n){return e.apply(this,arguments)}}())};var I=Object(s.c)({tasks:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"UpdateTask":return function(e,t,n){var a=e[t];if(!a)throw new Error("No task found with id {id}");return e[t]=v({},a,{},n),v({},e)}(e,t.id,t.task);case"CreateTask":return m(e,t.task);default:return e}},dataStorage:function(e){return e||{status:"inactive"}}}),F=function(e,t){return e=function(e,t){if(void 0==e)throw new Error("dataStorageReducer: Unexpected undefined model.");switch(t.type){case"ModelFetching":return N({},e,{dataStorage:N({},e.dataStorage,{status:"fetching",fetchError:void 0})});case"ModelFetched":return N({},t.model,{dataStorage:N({},e.dataStorage,{status:"inactive",fetchError:void 0})});case"ModelFetchError":return N({},e,{dataStorage:N({},e.dataStorage,{status:"inactive",fetchError:t.error})});case"ModelSaving":return N({},e,{dataStorage:N({},e.dataStorage,{status:"saving",saveError:void 0})});case"ModelSaved":return N({},e,{dataStorage:N({},e.dataStorage,{status:"inactive",saveError:void 0})});case"ModelSaveError":return N({},e,{dataStorage:N({},e.dataStorage,{status:"inactive",saveError:t.error})});default:return e}}(e=I(e,t),t)},R=(n(341),n(34)),q=n(33);var _=n(175),U=n(178),B=n(176),H=n(179),J=function(e){function t(e){var n;return Object(k.a)(this,t),(n=Object(U.a)(this,Object(B.a)(t).call(this,e))).state={isError:!1,error:null},n}return Object(H.a)(t,e),Object(_.a)(t,[{key:"componentDidCatch",value:function(e,t){this.setState({isError:!0,error:t})}},{key:"render",value:function(){return this.state.isError?a.createElement("div",null,this.state.error.componentStack):this.props.children}}]),t}(a.Component);n(342);function L(e){var t=Math.round((e.getTime()-(new Date).getTime())/1e3);return t>100?"".concat(Math.round(t/60)," minutes"):"".concat(Math.round(t)," seconds")}function W(e){var t=e.authState,n="Authenticated"==t.status?t.expiration:null,a=r.a.useState(null===n?null:L(n)),o=Object(q.a)(a,2),c=o[0],i=o[1];return r.a.useEffect((function(){if(null!==n){var e=setInterval((function(){i(L(n))}),1e3);return function(){return clearInterval(e)}}}),[n]),null===n?r.a.createElement("div",null,"Not authenticated."):r.a.createElement("div",{className:"authStatus"},t.status,", expiration: ",c,r.a.createElement("span",{className:"authRenewButton",onClick:S.authenticate},"Renew"))}n(171);function G(e){return r.a.createElement("div",{onClick:e.onClick,className:"task"},e.task.title)}n(343);var $=function(e){var t=e.onClick,n=e.children;return r.a.createElement("div",{className:"button",onClick:t},n)};function z(e){var t=Object(a.useMemo)((function(){return e.task?e.task.id:void 0}),[e.task]),n=Object(a.useState)(e.task||{title:""}),o=Object(q.a)(n,2),c=o[0],i=o[1],s=function(){var e=Object(h.b)();return{createTask:function(t){return e({type:"CreateTask",task:t})},updateTask:function(t,n){return e({type:"UpdateTask",id:t,task:n})}}}(),u=s.createTask,l=s.updateTask;return r.a.createElement("div",{className:"taskForm"},"Titre",r.a.createElement("br",null),r.a.createElement("input",{type:"text",value:c.title,onChange:function(e){return i({title:e.target.value})}}),r.a.createElement("div",null,r.a.createElement($,{onClick:function(){t?l(t,c):u(c),e.onClose()}},"Enregistrer"),r.a.createElement($,{onClick:e.onClose},"Fermer")))}function K(){var e=g(),t=r.a.useState({isOpen:!1}),n=Object(q.a)(t,2),a=n[0],o=n[1];return r.a.createElement("div",{className:"tasks"},Object.keys(e).map((function(t){return r.a.createElement(G,{key:t,task:e[t],onClick:function(){return o({isOpen:!0,taskId:t})}})})),a.isOpen&&r.a.createElement(z,{task:a.taskId?e[a.taskId]:void 0,onClose:function(){return o({isOpen:!1})}}),r.a.createElement($,{onClick:function(){return o({isOpen:!0,taskId:void 0})}},"+"))}n(344),n(345);var Q=function(e){var t=e.children;return r.a.createElement("div",{className:"overlay"},t)},V=function(e){return r.a.createElement(Q,null,r.a.createElement("div",{className:"messageDialog"},e.children))};function X(){var e=Object(R.f)();return r.a.createElement(r.a.Fragment,null,"Invalid path: \xab ",e.pathname," \xbb")}var Y=function(){var e=function(){var e=Object(a.useState)(S.getState()),t=Object(q.a)(e,2),n=t[0],o=t[1];return r.a.useEffect((function(){S.subscribe(o)}),[]),n}(),t=Object(h.c)((function(e){return e.dataStorage})),n=function(){var e=Object(h.b)();return function(){return D(e)}}(),o=function(){var e=Object(h.b)();return function(){return e(function(){var e=Object(E.a)(b.a.mark((function e(t,n){var a,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("inactive"===(a=n()).dataStorage.status){e.next=3;break}throw Error("An action is already ongoing.");case 3:return t({type:"ModelSaving"}),e.prev=4,e.next=7,P.saveData(a);case 7:r=e.sent,t({type:"ModelSaved",model:r}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),t({type:"ModelSaveError",error:e.t0});case 14:case"end":return e.stop()}}),e,null,[[4,11]])})));return function(t,n){return e.apply(this,arguments)}}())}}();return"Error"===e.status?r.a.createElement(V,null,'Authentication failed: "',e.errorMessage,'"'):"AuthenticationNeeded"===e.status?r.a.createElement(V,null,"Auth required. AuthenticationNeeded..."):"TokenReceived"===e.status?r.a.createElement(V,null,"TokenReceived..."):r.a.createElement("div",{className:"App"},r.a.createElement("header",null,r.a.createElement(i.b,{to:"/"},"Home"),r.a.createElement(i.b,{to:"/tasks"},"T\xe2ches"),r.a.createElement(W,{authState:e}),r.a.createElement($,{onClick:n},"Charger"),r.a.createElement($,{onClick:o},"Enregistrer")),r.a.createElement("section",null,r.a.createElement(J,null,r.a.createElement(R.c,null,r.a.createElement(R.a,{path:"/",exact:!0},"Home page"),r.a.createElement(R.a,{path:"/tasks",exact:!0},r.a.createElement(K,null)),r.a.createElement(R.a,{path:"*"},r.a.createElement(X,null))))),"fetching"==t.status&&r.a.createElement(V,null,"Chargement en cours..."),"saving"==t.status&&r.a.createElement(V,null,"Enregistrement en cours..."))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement((function(){var e=Object(a.useMemo)((function(){var e=Object(s.d)(F,Object(s.a)(u.a));return D(e.dispatch),e}),[]);return r.a.createElement(h.a,{store:e},r.a.createElement(i.a,null,r.a.createElement(Y,null)))}),null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},92:function(e,t){}},[[180,1,2]]]);
//# sourceMappingURL=main.197cb209.chunk.js.map