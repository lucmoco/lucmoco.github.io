(this.webpackJsonpboussole=this.webpackJsonpboussole||[]).push([[0],{172:function(e,t,n){e.exports=n(336)},177:function(e,t,n){},178:function(e,t,n){},220:function(e,t){},222:function(e,t){},256:function(e,t){},257:function(e,t){},330:function(e,t,n){},331:function(e,t,n){},336:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(164),s=n.n(i),o=(n(177),n(178),n(28)),c=n(61),u=n(40),l=n(6),h=n.n(l),d=n(39),f=n(60),m=n(165),p=["https://www.googleapis.com/auth/userinfo.profile","https://www.googleapis.com/auth/drive"];window.boussoleAuthManager||(window.boussoleAuthManager=new function e(){var t=this;Object(f.a)(this,e),this.oAuth2Client=new m.OAuth2Client({clientId:"186913784324-548k2j5jsqlht13qhu2miegr42fu0v56.apps.googleusercontent.com",redirectUri:"".concat(window.location.origin)}),this.state=void 0,this.listeners=[],this.setState=function(e){t.state=e,t.listeners.forEach((function(t){return t(e)}))},this.subscribe=function(e){t.listeners.push(e)},this.unsubscribe=function(e){var n=t.listeners.indexOf(e);n>-1&&t.listeners.splice(n,1)},this.getState=function(){return t.state},this.getOAuth2Client=function(){return t.oAuth2Client},this.authenticate=function(){console.debug("Auth: RedirectingToGoogle"),t.state={status:"AuthenticationNeeded"},Object(d.a)(h.a.mark((function e(){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.oAuth2Client.generateAuthUrl({scope:p,login_hint:"lucmoco@gmail.com",state:window.location.pathname+window.location.search+window.location.hash,response_type:"token"}),window.location.href=n;case 2:case"end":return e.stop()}}),e)})))()},this.oAuth2Client.transporter.configure();var n=new URLSearchParams(window.location.hash.substr(1)),a=n.get("access_token");if(null!=a){var r=n.get("state");if(!r)throw new Error("missing originalPage field.");var i=n.get("expires_in");if(!i)throw new Error("missing expires_in field.");var s=new Date;s.setSeconds(s.getSeconds()+parseInt(i)),console.debug("Auth: TokenReceived"),this.state={status:"TokenReceived"},this.oAuth2Client.setCredentials({access_token:a}),localStorage.setItem("access_token","".concat(a,"|").concat(s.toISOString())),window.history.replaceState(null,"",r),this.setState({status:"Authenticated",expiration:s})}else{var o=localStorage.getItem("access_token"),c=null;if(o){var u=o.split("|");a=u[0],(c=new Date(u[1])).getTime()<(new Date).getTime()+6e5&&(c=null)}null!=c?(this.oAuth2Client.setCredentials({access_token:a}),this.state={status:"Authenticated",expiration:c}):(this.state={status:"AuthenticationNeeded"},this.authenticate())}});var w=window.boussoleAuthManager;function v(){w.authenticate()}function g(){var e=Object(a.useState)(w.getState()),t=Object(u.a)(e,2),n=t[0],i=t[1];return r.a.useEffect((function(){var e;e=i,w.subscribe(e)}),[]),n}var b=n(166),E=n(170),k=n(167),A=n(171),S=function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(E.a)(this,Object(k.a)(t).call(this,e))).state={isError:!1,error:null},n}return Object(A.a)(t,e),Object(b.a)(t,[{key:"componentDidCatch",value:function(e,t){this.setState({isError:!0,error:t})}},{key:"render",value:function(){return this.state.isError?a.createElement("div",null,this.state.error.componentStack):this.props.children}}]),t}(a.Component);n(330);function O(e){var t=Math.round((e.getTime()-(new Date).getTime())/1e3);return t>100?"".concat(Math.round(t/60)," minutes"):"".concat(Math.round(t)," seconds")}function x(e){var t=e.authState,n="Authenticated"==t.status?t.expiration:null,a=r.a.useState(null===n?null:O(n)),i=Object(u.a)(a,2),s=i[0],o=i[1];return r.a.useEffect((function(){if(null!==n){var e=setInterval((function(){o(O(n))}),1e3);return function(){return clearInterval(e)}}}),[n]),null===n?r.a.createElement("div",null,"Not authenticated."):r.a.createElement("div",{className:"authStatus"},t.status,", expiration: ",s,r.a.createElement("span",{className:"authRenewButton",onClick:v},"Renew"))}n(331);function j(){return C.apply(this,arguments)}function C(){return(C=Object(d.a)(h.a.mark((function e(){var t,n,a,r,i,s,o,c;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=w.getOAuth2Client(),null!=(n=window.localStorage.NotesFileId)){e.next=13;break}return a=new URLSearchParams({q:"'root' in parents and mimeType = 'application/vnd.google-apps.folder' and name = 'notes-perso-boussole'",fields:"files/id"}),e.next=6,t.request({url:"https://www.googleapis.com/drive/v3/files?".concat(a)});case 6:return r=e.sent,i=r.data.files[0].id,s=new URLSearchParams({q:"'".concat(i,"' in parents and name = 'notes.json'"),fields:"files/id"}),e.next=11,t.request({url:"https://www.googleapis.com/drive/v3/files?".concat(s)});case 11:o=e.sent,window.localStorage.NotesFileId=n=o.data.files[0].id;case 13:return e.next=15,t.request({url:"https://www.googleapis.com/drive/v3/files/".concat(n,"?alt=media")});case 15:return c=e.sent,e.abrupt("return",c.data);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e){return r.a.createElement("div",{className:"task"},e.title)}function I(){var e=r.a.useState({tasks:[]}),t=Object(u.a)(e,2),n=t[0],a=t[1];return r.a.useEffect((function(){Object(d.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=a,e.next=4,j();case 4:e.t1=e.sent,(0,e.t0)(e.t1),e.next=11;break;case 8:e.prev=8,e.t2=e.catch(0),a(e.t2.toString());case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))()}),[]),r.a.createElement("div",{className:"tasks"},n.tasks.map((function(e){return r.a.createElement(N,Object.assign({key:e.id},e))})))}function T(){var e=Object(o.f)();return r.a.createElement(r.a.Fragment,null,"Invalid path: \xab ",e.pathname," \xbb")}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement((function(){var e=g();return"Error"===e.status?r.a.createElement("div",null,'Authentication failed: "',e.errorMessage,'"'):"AuthenticationNeeded"===e.status?r.a.createElement("div",null,"Auth required. AuthenticationNeeded..."):"TokenReceived"===e.status?r.a.createElement("div",null,"TokenReceived..."):r.a.createElement(c.a,null,r.a.createElement("div",{className:"App"},r.a.createElement("header",null,r.a.createElement(c.b,{to:"/"},"Home"),r.a.createElement(c.b,{to:"/tasks"},"Tasks"),r.a.createElement(x,{authState:e})),r.a.createElement("section",null,r.a.createElement(S,null,r.a.createElement(o.c,null,r.a.createElement(o.a,{path:"/",exact:!0},"Home"),r.a.createElement(o.a,{path:"/tasks",exact:!0},r.a.createElement(I,null)),r.a.createElement(o.a,{path:"*"},r.a.createElement(T,null)))))))}),null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},85:function(e,t){}},[[172,1,2]]]);
//# sourceMappingURL=main.67602560.chunk.js.map